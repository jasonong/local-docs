<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN"
"http://www.w3.org/TR/REC-html40/strict.dtd">
<HTML><HEAD>
  <LINK rev="made" href="mailto:slagell@ruby-lang.org">
  <TITLE>Ruby User's Guide</TITLE>
</HEAD>
<BODY bgcolor="#e0e0e0" text="black" vlink="#4444ff"alink="yellow" alink="4444a0">
<a name="index"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Contents</font></td><td width="10%">&nbsp;</td></tr></table>

<p><a href="http://www.ruby-lang.org">Ruby</a> is "an easy object
oriented language". It may seem a little strange at first, but
it is designed to be easily read and written. This <em>User's
Guide</em> will get you started at invoking and using ruby, and give
you insights into ruby's nature that you may not get from the
reference manual.</p>
<h2><a name="label:0" id="label:0">Table of contents</a></h2><!-- RDLabel: "Table of contents" -->
<p><hr><table border="0" cellpadding="1" align="center" width="80%"><tr><td>&nbsp;1.<a href="#whatisruby">What is ruby?</a></td>
<td>15. <a href="#accesscontrol">Access control</a></td>
</tr>
<tr><td>&nbsp;2.<a href="#getstarted">Getting Started</a></td>
<td>16. <a href="#singletonmethods">Singleton methods</a></td>
</tr>
<tr><td>&nbsp;3.<a href="#examples">Simple examples</a></td>
<td>17. <a href="#modules">Modules</a></td>
</tr>
<tr><td>&nbsp;4.<a href="#strings">Strings</a></td>
<td>18. <a href="#procobjects">Procedure objects</a></td>
</tr>
<tr><td>&nbsp;5.<a href="#regexp">Regular expressions</a></td>
<td>19. <a href="#variables">Variables</a></td>
</tr>
<tr><td>&nbsp;6.<a href="#arrays">Arrays</a></td>
<td>20. <a href="#globalvars">Global variables</a></td>
</tr>
<tr><td>&nbsp;7.<a href="#backtoexamples">Back to the simple examples</a></td>
<td>21. <a href="#instancevars">Instance variables</a></td>
</tr>
<tr><td>&nbsp;8.<a href="#control">Control structures</a></td>
<td>22. <a href="#localvars">Local variables</a></td>
</tr>
<tr><td>&nbsp;9.<a href="#iterators">Iterators</a></td>
<td>23. <a href="#constants">Class constants</a></td>
</tr>
<tr><td>10.<a href="#oothinking">Object-oriented thinking</a></td>
<td>24. <a href="#rescue">Exception processing: rescue</a></td>
</tr>
<tr><td>11.<a href="#methods">Methods</a></td>
<td>25. <a href="#ensure">Exception processing: ensure</a></td>
</tr>
<tr><td>12.<a href="#classes">Classes</a></td>
<td>26. <a href="#accessors">Accessors</a></td>
</tr>
<tr><td>13.<a href="#inheritance">Inheritance</a></td>
<td>27. <a href="#objinitialization">Object initialization</a></td>
</tr>
<tr><td>14.<a href="#redefinemethods">Redefinition of methods</a></td>
<td>28. <a href="#misc">Nuts and bolts</a></td>
</tr>
</table><hr>
</p>
<h3><a name="label:1" id="label:1">Document history</a></h3><!-- RDLabel: "Document history" -->
<ul>
<li>Original Japanese version by <a href="mailto:matz@netlab.co.jp">matz</a>.</li>
<li><a href="http://www.math.sci.hokudai.ac.jp/~gotoken/ruby/ruby-uguide/">First English translation</a> by
   <a href="mailto:gotoken@notwork.org">GOTO Kentaro</a> &amp; Julian Fondren.</li>
<li>Further translation and editing by <a href="mailto:slagell@ruby-lang.org">Mark Slagell</a>.</li>
</ul>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="whatisruby"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">What is ruby?</font></td><td width="10%">&nbsp;</td></tr></table>

<p>Ruby is "an interpreted scripting language for quick and easy
object-oriented programming"; what does this mean?</p>
<p>interpreted scripting language:</p>
<ul>
<li>ability to make operating system calls directly</li>
<li>powerful string operations and regular expressions</li>
<li>immediate feedback during development</li>
</ul>
<p>quick and easy:</p>
<ul>
<li>variable declarations are unnecessary</li>
<li>variables are not typed</li>
<li>syntax is simple and consistent</li>
<li>memory management is automatic</li>
</ul>
<p>object oriented programming:</p>
<ul>
<li>everything is an object</li>
<li>classes, inheritance, methods, etc.</li>
<li>singleton methods</li>
<li>mixin by module</li>
<li>iterators and closures</li>
</ul>
<p>also:</p>
<ul>
<li>multiple precision integers</li>
<li>exception processing model</li>
<li>dynamic loading</li>
<li>threads</li>
</ul>
<p>If you are unfamiliar with some of the concepts above, read on, and
don't worry.  The mantra of the ruby language is <em>quick and
easy</em>.</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="getstarted"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Getting Started</font></td><td width="10%">&nbsp;</td></tr></table>

<p>First, you'll want to check whether ruby is installed.  From
the shell prompt (denoted here by "<code>%</code>", so don't type the
<code>%</code>), type</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">% ruby -v</font></pre></td></tr></table>
<p>(<code>-v</code> tells the interpreter to print the version of ruby),
then press the <em>Enter</em> key.  If ruby is installed, you will
see a message something like the following:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">% ruby -v
ruby 1.6.6 (2001-12-26) [i586-linux]</font></pre></td></tr></table>
<p>If ruby is not installed, you can ask your administrator to install
it, or you can <a href="http://www.cs.iastate.edu/~slagell/ruby/install.shtml">do it
yourself</a>
, since ruby is free software with no restrictions on its
installation or use.</p>
<p>Now, let's play with ruby.  You can place a ruby program
directly on the command line using the <code>-e</code> option: </p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">% ruby -e 'print "hello world\n"'
hello world</font></pre></td></tr></table>
<p>More conventionally, a ruby program can be stored in a file.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">% cat &gt; test.rb
print "hello world\n"
^D
% cat test.rb
print "hello world\n"
% ruby test.rb
hello world</font></pre></td></tr></table>
<p><code>^D</code> is <em>control-D</em>.  The above is just for UNIX.  If you're using
DOS, try this:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">C:\ruby&gt; copy con: test.rb
print "hello world\n"
^Z
C:\ruby&gt; type test.rb
print "hello world\n"
C:\ruby&gt; ruby test.rb
hello world</font></pre></td></tr></table>
<p>When writing more substantial code than this, you will want to use
a real text editor!</p>
<p>Some surprisingly complex and useful things can be done with
miniature programs that fit in a command line.  For example, this
one replaces <code>foo</code> with <code>bar</code> in all C source
and header files in the current working directory, backing up the
original files with ".bak" appended:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">% ruby -i.bak -pe 'sub "foo", "bar"' *.[ch]</font></pre></td></tr></table>
<p>This program works like the UNIX <code>cat</code> command (but works
slower than <code>cat</code>):</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">% ruby -pe 0 file</font></pre></td></tr></table>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="examples"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Simple examples</font></td><td width="10%">&nbsp;</td></tr></table>

<p>Let's write a function to compute factorials.  The
mathematical definition of <code>n</code> factorial is:</p>
<pre>n! = 1                (when n==0)
   = n * (n-1)!       (otherwise)</pre>
<p>In ruby, this can be written as:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">def fact(n)
  if n == 0
    1
  else
    n * fact(n-1)
  end
end</font></pre></td></tr></table>
<p>You may notice the repeated occurrence of <code>end</code>.  Ruby
has been called "Algol-like" because of this.  (Actually, the
syntax of ruby more closely mimics that of a langage named
Eiffel.) You may also notice the lack of a <code>return</code>
statement.  It is unneeded because a ruby function returns the
last thing that was evaluated in it.  Use of a <code>return</code>
statement here is permissible but unnecessary.</p>
<p>Let's try out our factorial function.  Adding one line of code
gives us a working program:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black"># Program to find the factorial of a number
# Save this as fact.rb

def fact(n)
  if n == 0
    1
  else
    n * fact(n-1)
  end
end

print fact(ARGV[0].to_i), "\n"</font></pre></td></tr></table>
<p>Here, <code>ARGV</code> is an array which contains the command line
arguments, and <code>to_i</code> converts a character string to an
integer.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">% ruby fact.rb 1
1
% ruby fact.rb 5
120</font></pre></td></tr></table>
<p>Does it work with an argument of 40? It would make your calculator
overflow...</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">% ruby fact.rb 40
815915283247897734345611269596115894272000000000</font></pre></td></tr></table>
<p>It does work.  Indeed, ruby can deal with any integer which is
allowed by your machine's memory. So 400! can be calculated:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">% ruby fact.rb 400
64034522846623895262347970319503005850702583026002959458684
44594280239716918683143627847864746326467629435057503585681
08482981628835174352289619886468029979373416541508381624264
61942352307046244325015114448670890662773914918117331955996
44070954967134529047702032243491121079759328079510154537266
72516278778900093497637657103263503315339653498683868313393
52024373788157786791506311858702618270169819740062983025308
59129834616227230455833952075961150530223608681043329725519
48526744322324386699484224042325998055516106359423769613992 
31917134063858996537970147827206606320217379472010321356624 
61380907794230459736069956759583609615871512991382228657857 
95493616176544804532220078258184008484364155912294542753848 
03558374518022675900061399560145595206127211192918105032491 
00800000000000000000000000000000000000000000000000000000000 
0000000000000000000000000000000000000000000</font></pre></td></tr></table>
<p>We cannot check the correctness at a glance, but it must be
right. :-)</p>
<h2><a name="label:0" id="label:0">The input/evaluation loop</a></h2><!-- RDLabel: "The input/evaluation loop" -->
<p>When you invoke ruby with no arguments, it reads commands from
standard input and executes them after the end of input:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">% ruby
print "hello world\n"
print "good-bye world\n"
^D
hello world
good-bye world</font></pre></td></tr></table>
<p>Ruby also comes with a program called <code>eval.rb</code> that
allows you to enter ruby code from the keyboard in an interactive
loop, showing you the results as you go.  It will be used
extensively through the rest of the tutorial.</p>
<p>If you have an ANSI-compliant terminal (this is almost certainly
true if you are running some flavor of UNIX; under DOS you need to
have installed <code>ANSI.SYS</code> or <code>ANSI.COM</code>), you
should use this <a href="eval.rb">enhanced <code>eval.rb</code></a>
that adds visual indenting assistance, warning reports, and color
highlighting.  Otherwise, look in the <code>sample</code>
subdirectory of the ruby distribution for the non-ANSI version that
works on any terminal.  Here is a short <code>eval.rb</code>
session:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">% ruby eval.rb
ruby&gt;<font color="#ffff00"><b> print "Hello, world.\n"</b></font>
Hello, world.
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> exit</b></font></font></pre></td></tr></table>
<p><code>hello world</code> is produced by <code>print</code>.  The next
line, in this case <code>nil</code>, reports on whatever was last
evaluated; ruby does not distinguish between <em>statements</em> and
<em>expressions</em>, so evaluating a piece of code basically means
the same thing as executing it.  Here, <code>nil</code> indicates
that <code>print</code> does not return a meaningful value.  Note
that we can leave this interpreter loop by saying <code>exit</code>,
although <code>^D</code> still works too.</p>
<p>Throughout this guide, "<code>ruby&gt;</code>" denotes the input prompt
for our useful little <code>eval.rb</code> program.</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="strings"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Strings</font></td><td width="10%">&nbsp;</td></tr></table>

<p>Ruby deals with strings as well as numerical data.  A string
may be double-quoted ("...") or single-quoted ('...').</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> "abc"</b></font>
<font color="#50ffff"><b>   "abc"</b></font>
ruby&gt;<font color="#ffff00"><b> 'abc'</b></font>
<font color="#50ffff"><b>   "abc"</b></font></font></pre></td></tr></table>
<p>Double- and single-quoting have different effects in some
cases.  A double-quoted string allows character escapes by a
leading backslash, and the evaluation of embedded expressions using
<code>#{}</code>.  A single-quoted string does not do this
interpreting; what you see is what you get.  Examples:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> print "a\nb\nc","\n"</b></font>
a
b
c
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> print 'a\nb\n',"\n"</b></font>
a\nb\nc
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> "\n"</b></font>
<font color="#50ffff"><b>   "\n"</b></font>
ruby&gt;<font color="#ffff00"><b> '\n'</b></font>
<font color="#50ffff"><b>   "\\n"</b></font>
ruby&gt;<font color="#ffff00"><b> "\001"</b></font>
<font color="#50ffff"><b>   "\001"</b></font>
ruby&gt;<font color="#ffff00"><b> '\001'</b></font>
<font color="#50ffff"><b>   "\\001"</b></font>
ruby&gt;<font color="#ffff00"><b> "abcd #{5*3} efg"</b></font>
<font color="#50ffff"><b>   "abcd 15 efg"</b></font>
ruby&gt;<font color="#ffff00"><b> var = " abc "</b></font>
<font color="#50ffff"><b>   " abc "</b></font>
ruby&gt;<font color="#ffff00"><b> "1234#{var}5678"</b></font>
<font color="#50ffff"><b>   "1234 abc 5678"</b></font></font></pre></td></tr></table>
<p>Ruby's string handling is smarter and more intuitive than C's.  For
instance, you can concatenate strings with <code>+</code>, and repeat a
string many times with <code>*</code>:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> "foo" + "bar"</b></font>
<font color="#50ffff"><b>   "foobar"</b></font>
ruby&gt;<font color="#ffff00"><b> "foo" * 2</b></font>
<font color="#50ffff"><b>   "foofoo"</b></font></font></pre></td></tr></table>
<p>Concatenating strings is much more awkward in C because of the need
for explicit memory management:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#d8d8e0"><tr><td><pre><font color="black">char *s = malloc(strlen(s1)+strlen(s2)+1);
strcpy(s, s1);
strcat(s, s2);
/* ... */
free(s);</font></pre></td></tr></table>
<p>But using ruby, we do not have to consider the space occupied by a
string.  We are free from all memory management.</p>
<p>Here are some things you can do with strings.</p>
<p>Concatenation:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> word = "fo" + "o"</b></font>
<font color="#50ffff"><b>   "foo"</b></font></font></pre></td></tr></table>
<p>Repetition:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> word = word * 2</b></font>
<font color="#50ffff"><b>   "foofoo"</b></font></font></pre></td></tr></table>
<p>Extracting characters (note that characters are integers in ruby):</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> word[0]</b></font>
<font color="#50ffff"><b>   102            # 102 is ASCII code of `f' </b></font>
ruby&gt;<font color="#ffff00"><b> word[-1]</b></font>
<font color="#50ffff"><b>   111            # 111 is ASCII code of `o'</b></font></font></pre></td></tr></table>
<p>(Negative indices mean offsets from the end of a string, rather
than the beginning.)</p>
<p>Extracting substrings:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> herb = "parsley"</b></font>
<font color="#50ffff"><b>   "parsley"</b></font>
ruby&gt;<font color="#ffff00"><b> herb[0,1]</b></font>
<font color="#50ffff"><b>   "p"</b></font>
ruby&gt;<font color="#ffff00"><b> herb[-2,2]</b></font>
<font color="#50ffff"><b>   "ey"</b></font>
ruby&gt;<font color="#ffff00"><b> herb[0..3]</b></font>
<font color="#50ffff"><b>   "pars"</b></font>
ruby&gt;<font color="#ffff00"><b> herb[-5..-2]</b></font>
<font color="#50ffff"><b>   "rsle"</b></font></font></pre></td></tr></table>
<p>Testing for equality:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> "foo" == "foo"</b></font>
<font color="#50ffff"><b>   true</b></font>
ruby&gt;<font color="#ffff00"><b> "foo" == "bar"</b></font>
<font color="#50ffff"><b>   false</b></font></font></pre></td></tr></table>
<p>Note: In ruby 1.0, results of the above are reported in uppercase,
e.g. <code>TRUE</code>.</p>
<p>Now, let's put some of these features to use.  This puzzle is
"guess the word," but perhaps the word "puzzle" is too dignified
for what is to follow <code>;-)</code></p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black"># save this as guess.rb
words = ['foobar', 'baz', 'quux']
secret = words[rand(3)]

print "guess? "
while guess = STDIN.gets
  guess.chop!
  if guess == secret
    print "You win!\n"
    break
  else
    print "Sorry, you lose.\n"
  end
  print "guess? "
end
print "The word was ", secret, ".\n"</font></pre></td></tr></table>
<p>For now, don't worry too much about the details of this code.
Here is what a run of the puzzle program looks like.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">% ruby guess.rb
guess? foobar
Sorry, you lose.
guess? quux
Sorry, you lose.
guess? ^D
The word was baz.</font></pre></td></tr></table>
<p>(I should have done a bit better, considering the 1/3 probability
of success.)</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="regexp"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Regular expressions</font></td><td width="10%">&nbsp;</td></tr></table>

<p>Let's put together a more interesting program.  This time we
test whether a string fits a description, encoded into a concise
<em>pattern</em>. </p>
<p>There are some characters and character combinations that have
special meaning in these patterns, including:</p>
<p><table border="1"><tr><td><code>[]</code> </td><td> range specificication (e.g., <code>[a-z]</code> means a letter in
the range <code>a</code> to <code>z</code>) </td></tr>
<tr><td>
<code>\w</code> </td><td> letter or digit; same as <code>[0-9A-Za-z]</code></td></tr>
<tr><td>
<code>\W</code> </td><td> neither letter or digit</td></tr>
<tr><td>
<code>\s</code> </td><td> space character; same as <code>[ \t\n\r\f]</code></td></tr>
<tr><td>
<code>\S</code> </td><td> non-space character</td></tr>
<tr><td>
<code>\d</code> </td><td> digit character; same as <code>[0-9]</code></td></tr>
<tr><td>
<code>\D</code> </td><td> non-digit character</td></tr>
<tr><td>
<code>\b</code> </td><td> backspace (0x08) (only if in a range specification)</td></tr>
<tr><td>
<code>\b</code> </td><td> word boundary (if not in a range specification)</td></tr>
<tr><td>
<code>\B</code> </td><td> non-word boundary</td></tr>
<tr><td>
<code>*</code> </td><td> zero or more repetitions of the preceding</td></tr>
<tr><td>
<code>+</code> </td><td> one or more repetitions of the preceding</td></tr>
<tr><td>
<code>{m,n}</code> </td><td> at least m and at most n repetitions of the preceding</td></tr>
<tr><td>
<code>?</code> </td><td> at most one repetition of the preceding; same as <code>{0,1}</code></td></tr>
<tr><td>
<code>|</code> </td><td> either preceding or next expression may match</td></tr>
<tr><td>
<code>()</code> </td><td> grouping</td></tr></table>
<p>The common term for patterns that use this strange vocabulary is
<em>regular expressions</em>.  In ruby, as in Perl, they are generally
surrounded by forward slashes rather than double quotes.  If you have
never worked with regular expressions before, they probably look
anything but <em>regular</em>, but you would be wise to spend some time
getting familiar with them.  They have an efficient expressive power
that will save you headaches (and many lines of code) whenever you
need to do pattern matching, searching, or other manipulations on text
strings.</p>
<p>For example, suppose we want to test whether a string fits this
description: "Starts with lower case f, which is immediately followed
by exactly one upper case letter, and optionally more junk after that,
as long as there are no more lower case characters."  If you're an
experienced C programmer, you've probably already written about a
dozen lines of code in your head, right?  Admit it; you can hardly
help yourself.  But in ruby you need only request that your string be
tested against the regular expression <code>/^f[A-Z](^[a-z])*$/</code>.</p>
<p>How about "Contains a hexadecimal number enclosed in angle
brackets"?  No problem.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> def chab(s)   # "contains hex in angle brackets"</b></font>
    |<font color="#ffff00"><b>    (s =~ /&lt;0(x|X)(\d|[a-f]|[A-F])+&gt;/) != nil</b></font>
    |<font color="#ffff00"><b> end</b></font>
  nil
ruby&gt;<font color="#ffff00"><b> chab "Not this one."</b></font>
  false
ruby&gt;<font color="#ffff00"><b> chab "Maybe this? {0x35}"    # wrong kind of brackets</b></font>
  false
ruby&gt;<font color="#ffff00"><b> chab "Or this? &lt;0x38z7e&gt;"    # bogus hex digit</b></font>
  false
ruby&gt;<font color="#ffff00"><b> chab "Okay, this: &lt;0xfc0004&gt;."</b></font>
  true</font></pre></td></tr></table>
<p>Though regular expressions can be puzzling at first glance, you
will quickly gain satisfaction in being able to express yourself so
economically.</p>
<p>Here is a little program to help you experiment with regular
expressions.  Store it as <code>regx.rb</code> and run it by
typing <code>"ruby regx.rb"</code> at the command line.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black"># Requires an ANSI terminal!

st = "\033[7m"
en = "\033[m"

while TRUE
  print "str&gt; "
  STDOUT.flush
  str = gets
  break if not str
  str.chop!
  print "pat&gt; "
  STDOUT.flush
  re = gets
  break if not re
  re.chop!
  str.gsub! re, "#{st}\\&amp;#{en}"
  print str, "\n"
end
print "\n"</font></pre></td></tr></table>
<p>The program requires input twice, once for a string and once for a
regular expression.  The string is tested against the regular
expression, then displayed with all the matching parts highlighted in
reverse video.  Don't mind details now; an analysis of this code
will come soon.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">str&gt; foobar
pat&gt; ^fo+
<font color="red"><b>foo</b></font>bar
~~~</font></pre></td></tr></table>
<p><em>What you see above as red text will appear as reverse video in the
program output.  The "~~~" lines are for the benefit of those using
text-based browsers.</em></p>
<p>Let's try several more inputs. </p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">str&gt; abc012dbcd555
pat&gt; \d
abc<font color="red"><b>012</b></font>dbcd<font color="red"><b>555</b></font>
<font color="#50ffff"><b>   ~~~    ~~~</b></font></font></pre></td></tr></table>
<p>If that surprised you, refer to the table at the top of this page:
<code>\d</code> has no relationship to the character <code>d</code>, but
rather matches a single digit. </p>
<p>What if there is more than one way to correctly match the pattern?</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">str&gt; foozboozer
pat&gt; f.*z
<font color="red"><b>foozbooz</b></font>er
~~~~~~~~</font></pre></td></tr></table>
<p><code>foozbooz</code> is matched instead of just <code>fooz</code>, since a
regular expression maches the longest possible substring.</p>
<p>Here is a pattern to isolate a colon-delimited time field.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">str&gt; Wed Feb  7 08:58:04 JST 1996
pat&gt; [0-9]+:[0-9]+(:[0-9]+)?
Wed Feb  7 <font color="red"><b>08:58:04</b></font> JST 1996
<font color="#50ffff"><b>           ~~~~~~~~</b></font></font></pre></td></tr></table>
<p>"<code>=~</code>" is a matching operator with respect to regular
expressions; it returns the position in a string where a match was
found, or <code>nil</code> if the pattern did not match. </p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> "abcdef" =~ /d/</b></font>
<font color="#50ffff"><b>   3</b></font>
ruby&gt;<font color="#ffff00"><b> "aaaaaa" =~ /d/</b></font>
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="arrays"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Arrays</font></td><td width="10%">&nbsp;</td></tr></table>

<p>You can create an <em>array</em> by listing some items within
square brackets (<code>[]</code>) and separating them with
commas. Ruby's arrays can accomodate diverse object types.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> ary = [1, 2, "3"]</b></font>
<font color="#50ffff"><b>   [1, 2, "3"]</b></font></font></pre></td></tr></table>
<p>Arrays can be concatenated or repeated just as strings can.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> ary + ["foo", "bar"]</b></font>
<font color="#50ffff"><b>   [1, 2, "3", "foo", "bar"]</b></font>
ruby&gt;<font color="#ffff00"><b> ary * 2</b></font>
<font color="#50ffff"><b>   [1, 2, "3", 1, 2, "3"]</b></font></font></pre></td></tr></table>
<p>We can use index numbers to refer to any part of a array.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> ary[0]</b></font>
<font color="#50ffff"><b>   1</b></font>
ruby&gt;<font color="#ffff00"><b> ary[0,2]</b></font>
<font color="#50ffff"><b>   [1, 2]</b></font>
ruby&gt;<font color="#ffff00"><b> ary[0..1]</b></font>
<font color="#50ffff"><b>   [1, 2]</b></font>
ruby&gt;<font color="#ffff00"><b> ary[-2]</b></font>
<font color="#50ffff"><b>   2</b></font>
ruby&gt;<font color="#ffff00"><b> ary[-2,2]</b></font>
<font color="#50ffff"><b>   [2, "3"]</b></font>
ruby&gt;<font color="#ffff00"><b> ary[-2..-1]</b></font>
<font color="#50ffff"><b>   [2, "3"]</b></font></font></pre></td></tr></table>
<p>(Negative indices mean offsets from the end of an array, rather than
the beginning.)</p>
<p>Arrays can be converted to and from strings, using <code>join</code>
and <code>split</code> respecitvely:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> str = ary.join(":")</b></font>
<font color="#50ffff"><b>   "1:2:3"</b></font>
ruby&gt;<font color="#ffff00"><b> str.split(":")</b></font>
<font color="#50ffff"><b>   ["1", "2", "3"]</b></font></font></pre></td></tr></table>
<h2><a name="label:0" id="label:0">Hashes</a></h2><!-- RDLabel: "Hashes" -->
<p>An associative array has elements that are accessed not by
sequential index numbers, but by <em>keys</em> which can have any sort
of value.  Such an array is sometimes called a <em>hash</em> or
<em>dictionary</em>; in the ruby world, we prefer the term
<em>hash</em>.  A hash can be constructed by quoting pairs of items
within curly braces (<code>{}</code>).  You use a key to find
something in a hash, much as you use an index to find something in an
array.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> h = {1 =&gt; 2, "2" =&gt; "4"}</b></font>
<font color="#50ffff"><b>   {1=&gt;2, "2"=&gt;"4"}</b></font>
ruby&gt;<font color="#ffff00"><b> h[1]</b></font>
<font color="#50ffff"><b>   2</b></font>
ruby&gt;<font color="#ffff00"><b> h["2"]</b></font>
<font color="#50ffff"><b>   "4"</b></font>
ruby&gt;<font color="#ffff00"><b> h[5]</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> h[5] = 10     # appending value</b></font>
<font color="#50ffff"><b>   10</b></font>
ruby&gt;<font color="#ffff00"><b> h</b></font>
<font color="#50ffff"><b>   {5=&gt;10, 1=&gt;2, "2"=&gt;"4"}</b></font>
ruby&gt;<font color="#ffff00"><b> h.delete 1   # deleting value</b></font>
<font color="#50ffff"><b>   2</b></font>
ruby&gt;<font color="#ffff00"><b> h[1]</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> h</b></font>
<font color="#50ffff"><b>   {5=&gt;10, "2"=&gt;"4"}</b></font></font></pre></td></tr></table>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="backtoexamples"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Back to the simple examples</font></td><td width="10%">&nbsp;</td></tr></table>

<p>Now let's take apart the code of some of our previous example
programs.</p>
<p>The following appeared in the <a href="#examples">simple examples</a> chapter.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">def fact(n)
  if n == 0
    1
  else
    n * fact(n-1)
  end
end
print fact(ARGV[0].to_i), "\n"</font></pre></td></tr></table>
<p>Because this is the first explanation, we examine each line
individually.</p>
<h3><a name="label:0" id="label:0">Factorials</a></h3><!-- RDLabel: "Factorials" -->
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">def fact(n)</font></pre></td></tr></table>
<p>In the first line, <code>def</code> is a statement to define a function
(or, more precisely, a <em>method</em>; we'll talk more about what a
method is in a <a href="#methods">later chapter</a>).  Here, it
specifies that the function <code>fact</code> takes a single argument,
referred to as <code>n</code>.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">if n == 0</font></pre></td></tr></table>
<p>The <code>if</code> is for checking a condition. When the condition
holds, the next bit of code is evaluated; otherwise whatever follows the
<code>else</code> is evaluated. </p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">1</font></pre></td></tr></table>
<p>The value of <code>if</code> is 1 if the condition holds. </p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">else</font></pre></td></tr></table>
<p>If the condition does not hold, the code from here to <code>end</code> is 
evaluated. </p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">n * fact(n-1)</font></pre></td></tr></table>
<p>If the condition is not satisfied, the value of <code>if</code> is
the result of <code>n</code> times <code>fact(n-1)</code>. </p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">end</font></pre></td></tr></table>
<p>The first <code>end</code> closes the <code>if</code> statement.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">end</font></pre></td></tr></table>
<p>The second <code>end</code> closes the <code>def</code> statement.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">print fact(ARGV[0].to_i), "\n"</font></pre></td></tr></table>
<p>This invokes our <code>fact()</code> function using a value specified
from the command line, and prints the result. </p>
<p><code>ARGV</code> is an array which contains command line arguments.
The members of <code>ARGV</code> are strings, so we must convert this into a
integral number by <code>to_i</code>.  Ruby does not convert strings into
integers automatically like perl does. </p>
<p>Hmmm...  what would happen if we fed this program a negative
number? Do you see the problem? Can you fix it?</p>
<h3><a name="label:1" id="label:1">Strings</a></h3><!-- RDLabel: "Strings" -->
<p>Next we examine the puzzle program from the chapter
on <a href="#strings">strings</a>.  As this is somewhat longer,
we number the lines for reference.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">01 words = ['foobar', 'baz', 'quux']
02 secret = words[rand(3)]
03
04 print "guess? "
05 while guess = STDIN.gets
06   guess.chop!
07   if guess == secret
08     print "you win\n"
09     break
10   else
11     print "you lose.\n"
12   end
13   print "guess? "
14 end
15 print "the word is ", secret, ".\n"</font></pre></td></tr></table>
<p>In this program, a new control structure, <code>while</code>, is
used.  The code between <code>while</code> and its corresponding
<code>end</code> will execute repeatedly as long as some specified
condition remains true.</p>
<p><code>rand(3)</code> in line 2 returns a random number
in the range 0 to 2.  This random number is used to extract one
of the members of the array <code>words</code>.</p>
<p>In line 5 we read one line from standard input by the method
<code>STDIN.gets</code>.  If <em>EOF</em> (end of file) occurs
while getting the line, <code>gets</code> returns
<code>nil</code>.  So the code associated with this
<code>while</code> will repeat until it sees <em>^D</em> (or
<em>^Z</em> under DOS), signifying the end of input.</p>
<p><code>guess.chop!</code> in line 6 removes the last character from
<code>guess</code>; in this case it will always be a <em>newline</em>
character.</p>
<p>In line 15 we print the secret word.  We have written this as
a print statement with three arguments (which are printed one after
the other), but it would have been equally effective to do it with a
single argument, writing <code>secret</code> as <code>#{secret}</code>
to make it clear that it is a variable to be evaluated, not a literal
word to be printed:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">print "the word is #{secret}.\n" </font></pre></td></tr></table>
<h3><a name="label:2" id="label:2">Regular expressions</a></h3><!-- RDLabel: "Regular expressions" -->
<p>Finally we examine this program from the chapter on <a href="#regexp">regular
expressions</a>.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">01 st = "\033[7m"
02 en = "\033[m"
03
04 while TRUE
05   print "str&gt; "
06   STDOUT.flush
07   str = gets
08   break if not str
09   str.chop!
10   print "pat&gt; "
11   STDOUT.flush
12   re = gets
13   break if not re
14   re.chop!
15   str.gsub! re, "#{st}\\&amp;#{en}"
16   print str, "\n"
17 end
18 print "\n"</font></pre></td></tr></table>
<p>In line 4, the condition for <code>while</code> is hardwired to
<code>true</code>, so it forms what looks like an infinite loop.
However we put <code>break</code> statements in the 8th and 13th lines to
escape the loop.  These two <code>break</code>s are also an example
of <code>if</code> modifiers.  An "<code>if</code> modifier" executes the
statement on its left hand side if and only if the specified
condition is satisfied.</p>
<p>There is more to say about <code>chop!</code> (see lines 9 and
14).  In ruby, we conventionally attach '<code>!</code>' or
'<code>?</code>' to the end of certain method names.  The
exclamation point (<code>!</code>, sometimes pronounced aloud as
"bang!") indicates something potentially destructive, that is to say,
something that can change the value of what it touches.
<code>chop!</code> affects a string directly, but <code>chop</code>
with no exclamation point works on a copy.  Here is an
illustration of the difference.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> s1 = "forth"</b></font>
  "forth"
ruby&gt;<font color="#ffff00"><b> s1.chop!       # This changes s1.</b></font>
  "fort"
ruby&gt;<font color="#ffff00"><b> s2 = s1.chop   # This puts a changed copy in s2,</b></font>
  "for"
ruby&gt;<font color="#ffff00"><b> s1             # ... without disturbing s1.</b></font>
  "fort"</font></pre></td></tr></table>
<p>You will later come across method names that end in a question mark
(<code>?</code>, sometimes pronounced aloud as "huh?"); this indicates
a "predicate" method, one that can return either <code>true</code> or
<code>false</code>.</p>
<p>Line 15 deserves some careful attention.  First, notice that
<code>gsub!</code> is another so-called destructive method.  It
changes <code>str</code> by replacing everything matching the pattern
<code>re</code> (<code>sub</code> means substitute, and the
leading <code>g</code> means global, i.e., replace <em>all</em>
matching parts in the string, not just the first one found).  So
far, so good; but what are we replacing the matched parts of the text
with?  <code>st</code> and <code>en</code> were defined in lines 1-2
as the ANSI sequences that make text color-inverted and normal,
respectively.  In line 15 they are enclosed in <code>#{}</code>
to ensure that they are actually interpreted as such (and we do not
see the variable <em>names</em> printed instead).  Between these
we see "<code>\\&amp;</code>".  This is a little tricky.
Since the replacement string is in double quotes, the pair of
backslashes will be interpreted as a single backslash; what
<code>gsub!</code> actually sees will be "<code>\&amp;</code>", and
that happens to be a special code that refers to whatever matched the
pattern in the first place.  So the new string, when printed,
looks just like the old one, except that the parts that matched the
given pattern are highlighted in inverse video.</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="control"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Control structures</font></td><td width="10%">&nbsp;</td></tr></table>

<p>This chapter explores more of ruby's control structures.</p>
<h3><a name="label:0" id="label:0"><code>case</code></a></h3><!-- RDLabel: "case" -->
<p>We use the <code>case</code> statement to test a sequence of
conditions.  This is superficially similar to <code>switch</code>
in C and Java but is considerably more powerful, as we shall see.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> i=8</b></font>
ruby&gt;<font color="#ffff00"><b> case i</b></font>
    |<font color="#ffff00"><b> when 1, 2..5</b></font>
    |<font color="#ffff00"><b>   print "1..5\n"</b></font>
    |<font color="#ffff00"><b> when 6..10</b></font>
    |<font color="#ffff00"><b>   print "6..10\n"</b></font>
    |<font color="#ffff00"><b> end</b></font>
6..10
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p><code>2..5</code> is an expression which means the <em>range</em>
between 2 and 5, inclusive.  The following expression tests
whether the value of <code>i</code> falls within that range: </p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">(2..5) === i</font></pre></td></tr></table>
<p><code>case</code> internally uses the relationship operator <code>===</code> to
check for several conditions at a time.  In keeping with ruby's
object oriented nature, <code>===</code> is interpreted suitably for the
object that appeared in the <code>when</code> condition.  For example,
the following code tests string equality in the first <code>when</code>, and
regular expression matching in the second <code>when</code>.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> case 'abcdef'</b></font>
    |<font color="#ffff00"><b> when 'aaa', 'bbb'</b></font>
    |<font color="#ffff00"><b>   print "aaa or bbb\n"</b></font>
    |<font color="#ffff00"><b> when /def/</b></font>
    |<font color="#ffff00"><b>   print "includes /def/\n"</b></font>
    |<font color="#ffff00"><b> end</b></font>
includes /def/
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<h3><a name="label:1" id="label:1"><code>while</code></a></h3><!-- RDLabel: "while" -->
<p>Ruby provides convenient ways to construct loops, although you will
find in the next chapter that learning how to use <em>iterators</em>
will make it unnecessary to write explicit loops very often.</p>
<p>A <code>while</code> is a repeated <code>if</code>.  We used it in our
word-guessing puzzle and in the regular expression programs (see the
<a href="#regexp">previous chapter</a>); there, it took the form
<code>while <em>condition</em> ... end</code> surrounding a block of code to
be repeated while <em>condition</em> was true.  But <code>while</code>
and <code>if</code> can as easily be applied to individual statements:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> i = 0</b></font>
<font color="#50ffff"><b>   0</b></font>
ruby&gt;<font color="#ffff00"><b> print "It's zero.\n" if i==0</b></font>
It's zero.
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> print "It's negative.\n" if i&lt;0</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> print "#{i+=1}\n" while i&lt;3</b></font>
1
2
3
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>Sometimes you want to negate a test condition.  An
<code>unless</code> is a negated <code>if</code>, and an <code>until</code> is a negated
<code>while</code>.  We'll leave it up to you to experiment with these.</p>
<p>There are four ways to interrupt the progress of a loop from
inside.  First, <code>break</code> means, as in C, to escape from the
loop entirely.  Second, <code>next</code> skips to the beginning of
the next iteration of the loop (corresponding to C's
<code>continue</code>).  Third, ruby has <code>redo</code>, which
restarts the current iteration.  The following is C code
illustrating the meanings of <code>break</code>, <code>next,</code> and
<code>redo</code>:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#d8d8e0"><tr><td><pre><font color="black">while (condition) {
 label_redo:
   goto label_next;        /* ruby's "next" */
   goto label_break;       /* ruby's "break" */
   goto label_redo;        /* ruby's "redo" */
   ...
   ...
 label_next:
}
label_break:
...</font></pre></td></tr></table>
<p>The fourth way to get out of a loop from the inside is
<code>return</code>.  An evaluation of <code>return</code> causes
escape not only from a loop but from the method that contains the
loop.  If an argument is given, it will be returned from the
method call, otherwise <code>nil</code> is returned.</p>
<h3><a name="label:2" id="label:2"><code>for</code></a></h3><!-- RDLabel: "for" -->
<p>C programmers will be wondering by now how to make a "for"
loop.  Ruby's <code>for</code> is a little more interesting than you
might expect.  The loop below runs once for each element in the
collection:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">for elt in collection
  ...
end</font></pre></td></tr></table>
<p>The collection can be a range of values (this is what most people
mean when they talk about a for loop):</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> for num in (4..6)</b></font>
    |<font color="#ffff00"><b>    print num,"\n"</b></font>
    |<font color="#ffff00"><b> end</b></font>
4
5
6
<font color="#50ffff"><b>   4..6</b></font></font></pre></td></tr></table>
<p>It may also be some other kind of collection, such as an
array:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> for elt in [100,-9.6,"pickle"]</b></font>
    |<font color="#ffff00"><b>    print "#{elt}\t(#{elt.type})\n"</b></font>
    |<font color="#ffff00"><b> end</b></font>
100    (Fixnum)
-9.6   (Float)
pickle (String)
<font color="#50ffff"><b>   [100, -9.6, "pickle"]</b></font></font></pre></td></tr></table>
<p>But we're getting ahead of ourselves.  <code>for</code> is really
another way of writing <code>each</code>, which, it so happens, is our first
example of an iterator.  The following two forms are
equivalent:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">#  If you're used to C or Java, you might prefer this.
for i in collection
  ...
end

#  A Smalltalk programmer might prefer this.
collection.each {|i|
  ...
}</font></pre></td></tr></table>
<p>Iterators can often be substituted for conventional loops, and once
you get used to them, they are generally easier to deal with.  So
let's move on and learn more about them.</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="iterators"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Iterators</font></td><td width="10%">&nbsp;</td></tr></table>

<p>Iterators are not an original concept with ruby.  They are in
common use in object-oriented languages.  They are also used in
Lisp, though there they are not called iterators.  However the
concepet of iterator is an unfamiliar one for many so it should be
explained in more detail.</p>
<p>The verb <em>iterate</em> means to do the same thing many times, you know, 
so an <em>iterator</em> is something that does the same thing many times.</p>
<p>When we write code, we need loops in various situations.  In
C, we code them using <code>for</code> or <code>while</code>. For example,</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#d8d8e0"><tr><td><pre><font color="black">char *str;
for (str = "abcdefg"; *str != '\0'; str++) {
  /* process a character here */
}</font></pre></td></tr></table>
<p>C's<code> for(...) </code>syntax provides an abstraction to help with
the creation of a loop, but the test of<code> *str </code>against a
null character requires the programmer to know details about the
internal structure of a string.  This makes C feel like a low-level
language.  Higher level languages are marked by their more flexible
support for iteration.  Consider the following<code> sh </code>shell
script:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">#!/bin/sh

for i in *.[ch]; do
  # ... here would be something to do for each file
done</font></pre></td></tr></table>
<p>All the C source and header files in the current directory are
processed, and the command shell handles the details of picking up and
substituting file names one by one.  I think this is working at a
higher level than C, don't you?</p>
<p>But there are is more to consider: while it is fine for a language to
provide iterators for built-in data types, it is a disappointment if
we must go back to writing low level loops to iterate over our own
data types.  In OOP, users often define one data type after
another, so this could be a serious problem.</p>
<p>So every OOP language includes some facilities for iteration.
Some languages provide a special class for this purpose; ruby allows
us to define iterators directly.</p>
<p>Ruby's <code>String</code> type has some useful iterators:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> "abc".each_byte{|c| printf "&lt;%c&gt;", c}; print "\n"</b></font>
&lt;a&gt;&lt;b&gt;&lt;c&gt;
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p><code>each_byte</code> is an iterator for each character in the
string.  Each character is substituted into the local variable
<code>c</code>.  This can be translated into something that looks
a lot like C code ...</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> s="abc";i=0</b></font>
<font color="#50ffff"><b>   0</b></font>
ruby&gt;<font color="#ffff00"><b> while i&lt;s.length</b></font>
    |<font color="#ffff00"><b>    printf "&lt;%c&gt;", s[i]; i+=1</b></font>
    |<font color="#ffff00"><b> end; print "\n"</b></font>
&lt;a&gt;&lt;b&gt;&lt;c&gt;
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>... however, the <code>each_byte</code> iterator is both conceptually
simpler and more likely to continue to work even if the
<code>String</code> class happens to be radically modified in the
future.  One benefit of iterators is that they tend to be robust
in the face of such changes; indeed that is a characteristic of good
code in general.  (Yes, have patience, we're about to talk about
what <em>classes</em> are, too.)</p>
<p>Another iterator of <code>String</code> is <code>each_line</code>.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> "a\nb\nc\n".each_line{|l| print l}</b></font>
a
b
c
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>The tasks that would take most of the programming effort in C (finding
line delimiters, generating substrings, etc.) are easily tackled using
iterators.</p>
<p>The <code>for</code> statement appearing in the previous chapter does
iteration by way of an <code>each</code> iterator.
<code>String</code>'s <code>each</code> works the same as
<code>each_line</code>, so let's rewrite the above example with
<code>for</code>:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> for l in "a\nb\nc\n"</b></font>
    |<font color="#ffff00"><b>   print l </b></font>
    |<font color="#ffff00"><b> end</b></font>
a
b
c
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>We can use a control structure <code>retry</code> in conjunction with
an iterated loop, and it will retry the current iteration of the loop
from the top.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> c=0</b></font>
<font color="#50ffff"><b>   0</b></font>
ruby&gt;<font color="#ffff00"><b> for i in 0..4</b></font>
    |<font color="#ffff00"><b>   print i</b></font>
    |<font color="#ffff00"><b>   if i == 2 and c == 0</b></font>
    |<font color="#ffff00"><b>     c = 1</b></font>
    |<font color="#ffff00"><b>     print "\n"</b></font>
    |<font color="#ffff00"><b>     retry</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end; print "\n"</b></font>
012
01234
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p><code>yield</code> occurs sometimes in a definition of an iterator.
<code>yield</code> moves control to the block of code that is passed to the
iterator (this will be explored in more detail in the chapter about
<a href="#procobjects">procedure objects</a>).  The following example defines
an iterator <code>repeat</code>, which repeats a block of code the number of
times specified in an argument.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> def repeat(num)</b></font>
    |<font color="#ffff00"><b>   while num &gt; 0</b></font>
    |<font color="#ffff00"><b>     yield</b></font>
    |<font color="#ffff00"><b>     num -= 1</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> repeat(3) { print "foo\n" }</b></font>
foo
foo
foo
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>With <code>retry</code>, one can define an iterator which works the
same as <code>while</code>, though it's too slow to be practical.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> def WHILE(cond)</b></font>
    |<font color="#ffff00"><b>   return if not cond</b></font>
    |<font color="#ffff00"><b>   yield</b></font>
    |<font color="#ffff00"><b>   retry</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> i=0; WHILE(i&lt;3) { print i; i+=1 }</b></font>
012   nil</font></pre></td></tr></table>
<p>Do you understand what an iterator is? There are a few
restrictions, but you can write your original iterators; and in fact,
whenever you define a new data type, it is often convenient to define
suitable iterators to go with it.  In this sense, the above
examples are not terribly useful.  We can talk about practical
iterators after we have a better understanding of what classes
are.</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="oothinking"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Object-oriented thinking</font></td><td width="10%">&nbsp;</td></tr></table>

<p><em>Object oriented</em> is a catchy phrase.  To call anything
object oriented can make you sound pretty smart.  Ruby claims to be
an object oriented scripting language; but what exactly does "object
oriented" mean?</p>
<p>There have been a variety of answers to that question, all of which
probably boil down to about the same thing.  Rather than sum it
too quickly, let's think for a moment about the traditional
programming paradigm.</p>
<p>Traditionally, a programming problem is attacked by coming up with
some kinds of <em>data representations</em>, and <em>procedures</em>
that operate on that data.  Under this model, data is inert,
passive, and helpless; it sits at the complete mercy of a large
procedural body, which is active, logical, and all-powerful.</p>
<p>The problem with this approach is that programs are written by
programmers, who are only human and can only keep so much detail clear
in their heads at any one time.  As a project gets larger, its
procedural core grows to the point where it is difficult to remember
how the whole thing works.  Minor lapses of thinking and
typographical errors become more likely to result in well-concealed
bugs.  Complex and unintended interactions begin to emerge within
the procedural core, and maintaining it becomes like trying to carry
around an angry squid without letting any tentacles touch your
face.  There are guidelines for programming that can help to
minimize and localize bugs within this traditional paradigm, but there
is a better solution that involves fundamentally changing the way we
work.</p>
<p>What object-oriented programming does is to let us delegate most of
the mundane and repetitive logical work <em>to the data itself</em>;
it changes our concept of data from <em>passive</em> to
<em>active</em>.  Put another way,</p>
<ul>
<li>We stop treating each piece of data as a box with an open lid
   that lets us reach in and throw things around.</li>
<li>We start treating each piece of data as a working machine with a
   closed lid and a few well-marked switches and dials.</li>
</ul>
<p>What is described above as a "machine" may be very simple or
complex on the inside; we can't tell from the outside, and we don't
allow ourselves to open the machine up (except when we are absolutely
sure something is wrong with its design), so we are required to do
things like flip the switches and read the dials to interact with the
data.  Once the machine is built, we don't want to have to
think about how it operates.</p>
<p>You might think we are just making more work for ourselves, but
this approach tends to do a nice job of preventing all kinds of things
from going wrong.</p>
<p>Let's start with a example that is too simple to be of practical
value, but should illustrate at least part of the concept.  Your
car has a tripmeter.  Its job is to keep track of the distance
the car has travelled since the last time its reset button was
pushed.  How would we model this in a programming language?
In C, the tripmeter would just be a numeric variable, possibly of type
<code>float</code>.  The program would manipulate that variable
by increasing its value in small increments, with occasional resets to
zero when appropriate.  What's wrong with that? A bug in
the program could assign a bogus value to the variable, for any number
of unexpected reasons.  Anyone who has programmed in C knows what
it is like to spend hours or days tracking down such a bug whose cause
seems absurdly simple once it has been found.  (The moment of
finding the bug is commonly indicated by the sound of a loud slap to
the forehead.)</p>
<p>The same problem would be attacked from a much different angle in
an object-oriented context.  The first thing a programmer asks
when designing the tripmeter is not "which of the familiar data types
comes closest to resembling this thing?" but "how exactly is this
thing supposed to act?" The difference winds up being a profound
one.  It is necessary to spend a little bit of time deciding
exactly what an odometer is for, and how the outside world expects to
interact with it.  We decide to build a little machine with
controls that allow us to increment it, reset it, read its value, and
nothing else.</p>
<p>We don't provide a way for a tripmeter to be assigned arbitary
values; why? because we all know tripmeters don't work that way.
There are only a few things you should be able to do with a tripmeter,
and those are all we allow.  Thus, if something else in the
program mistakenly tries to place some other value (say, the target
temperature of the vehicle's climate control) into the tripmeter,
there is an immediate indication of what went wrong.  We are told
when running the program (or possibly while compiling, depending on
the nature of the language) that <em>we are not allowed to assign
aribtrary values to Tripmeter objects</em>.  The message might
not be exactly that clear, but it will be reasonably close to
that.  It doesn't prevent the error, does it? But it
quickly points us in the direction of the cause.  This is only
one of several ways in which OO programming can save a lot of wasted
time.</p>
<p>We commonly take one step of abstraction above this, because it
turns out to be as easy to build a factory that makes machines as it
is to make an individual machine.  We aren't likely to build a
single tripmeter directly; rather, we arrange for any number of
tripmeters to be built from a single pattern.  The pattern (or if
you like, the tripmeter factory) corresponds to what we call a
<em>class</em>, and an individual tripmeter generated from the pattern
(or made by the factory) corresponds to an <em>object</em>.  Most
OO languages require a class to be defined before we can have a new
kind of object, but ruby does not.</p>
<p>It's worth noting here that the use of an OO language will not
<em>enforce</em> proper OO design.  Indeed it is possible in any
language to write code that is unclear, sloppy, ill-conceived, buggy,
and wobbly all over.  What ruby does for you (as opposed,
especially, to C++) is to make the practice of OO programming feel
natural enough that even when you are working on a small scale you
don't feel a necessity to resort to ugly code to save effort.  We
will be discussing the ways in which ruby accomplishes that admirable
goal as this guide progresses; the next topic will be the "switches
and dials" (object methods) and from there we'll move on to the
"factories" (classes).  Are you still with us?</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="methods"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Methods</font></td><td width="10%">&nbsp;</td></tr></table>

<p>What is a method? In OO programming, we don't think of
operating on data directly from outside an object; rather, objects
have some understanding of how to operate on themselves (when asked
nicely to do so). You might say we pass messages to an object,
and those messages will generally elicit some kind of an action or
meaningful reply. This ought to happen without our necessarily
knowing or caring how the object really works inside. The tasks
we are allowed to ask an object to perform (or equivalently, the
messages it understands) are that object's <em>methods</em>.</p>
<p>In ruby, we invoke a method of an object with dot notation (just as
in C++ or Java). The object being talked to is named to the left
of the dot.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> "abcdef".length</b></font>
<font color="#50ffff"><b>   6</b></font></font></pre></td></tr></table>
<p>Intuitively, <em>this string object is being asked how long it
is</em>.  Technically, we are invoking the <code>length</code> method
of the object <code>"abcdef"</code>.</p>
<p>Other objects may have a slightly different interpretation of
<code>length</code>, or none at all.  Decisions about how to respond
to a message are made on the fly, during program execution, and the
action taken may change depending on what a variable refers to.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> foo = "abc"</b></font>
<font color="#50ffff"><b>   "abc"</b></font>
ruby&gt;<font color="#ffff00"><b> foo.length</b></font>
<font color="#50ffff"><b>   3</b></font>
ruby&gt;<font color="#ffff00"><b> foo = ["abcde", "fghij"]</b></font>
<font color="#50ffff"><b>   ["abcde", "fghij"]</b></font>
ruby&gt;<font color="#ffff00"><b> foo.length</b></font>
<font color="#50ffff"><b>   2</b></font></font></pre></td></tr></table>
<p>What we mean by <em>length</em> can vary depending on what object
we are talking about.  The first time we ask<code> foo </code>for its
length in the above example, it refers to a simple string, and there
can only be one sensible answer.  The second time,<code> foo
</code>refers to an array, and we might reasonably think of its length
as either 2, 5, or 10; but the most generally applicable answer is of
course 2 (the other kinds of length can be figured out if wished).</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> foo[0].length</b></font>
<font color="#50ffff"><b>   5</b></font>
ruby&gt;<font color="#ffff00"><b> foo[0].length + foo[1].length</b></font>
<font color="#50ffff"><b>   10</b></font></font></pre></td></tr></table>
<p>The thing to notice here is that an array <em>knows something about
what it means to be an array</em>.  Pieces of data in ruby carry such
knowledge with them, so that the demands made on them can
automatically be satisfied in the various appropriate ways.  This
relieves the programmer from the burden of memorizing a great many
specific function names, because a relatively small number of method
names, corresponding to concepts that we know how to express in
natural language, can be applied to different kinds of data and the
results will be what we expect.  This feature of OO programming
languages (which, IMHO, Java has done a poor job of exploiting) is
called <em>polymorphism</em>.</p>
<p>When an object receives a message that it does not understand, an
error is "raised":</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> foo = 5</b></font>
<font color="#50ffff"><b>   5</b></font>
ruby&gt;<font color="#ffff00"><b> foo.length</b></font>
<font color="#50ffff"><b>ERR: (eval):1: undefined method `length' for 5(Fixnum)</b></font></font></pre></td></tr></table>
<p>So it is necessary to know what methods are acceptable to an object,
though we need not know how the methods are processed.</p>
<p>If arguments are given to a method, they are generally surrounded by
parentheses,</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">object.method(arg1, arg2)</font></pre></td></tr></table>
<p>but they can be omitted if doing so does not cause ambiguity.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">object.method arg1, arg2</font></pre></td></tr></table>
<p>There is a special variable <code>self</code> in ruby; it refers to
whatever object calls a method.  This happens so often that for
convenience the "<code>self.</code>" may be omitted from method calls from
an object to itself:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">self.method_name(args...)</font></pre></td></tr></table>
<p>is the same as</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">method_name(args...)</font></pre></td></tr></table>
<p>What we would think of traditionally as a <em>function call</em> is
just this abbreviated way of writing method invocations by
<code>self</code>.  This makes ruby what is called a pure object
oriented language.  Still, functional methods behave quite
similarly to the functions in other programming languages for the
benefit of those who do not grok how function calls are really object
methods in ruby.  We can speak of <em>functions</em> as if they
were not really object methods if we want to.</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="classes"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Classes</font></td><td width="10%">&nbsp;</td></tr></table>

<p>The real world is filled by objects, and we can classify
them.  For example, a very small child is likely to say "bow-wow"
when seeing a dog, regardless of the breed; we naturally see the world
in terms of these categories.</p>
<p>In OO programming terminology, a category of objects like "dog" is
called a <em>class</em>, and some specific object belonging to a class
is called an <em>instance</em> of that class.</p>
<p>Generally, to make an object in ruby or any other OO language,
first one defines the characteristics of a class, then creates an
instance.  To illustrate the process, let's first define a simple
<code>Dog</code> class.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class Dog</b></font>
    |<font color="#ffff00"><b>   def speak</b></font>
    |<font color="#ffff00"><b>     print "Bow Wow\n"</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>In ruby, a class definition is a region of code between the keywords
<code>class</code> and <code>end</code>.  A <code>def</code> inside this region begins the
definition of a <em>method</em> of the class, which as we discussed in
the previous chapter, corresponds to some specific behavior for
objects of that class.</p>
<p>Now that we have defined a <code>Dog</code> class, we can use it to
make a dog:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> pochi = Dog.new</b></font>
<font color="#50ffff"><b>   #&lt;Dog:0xbcb90&gt;</b></font></font></pre></td></tr></table>
<p>We have made a new instance of the class <code>Dog</code>, and have
given it the name <code>pochi</code>.  The <code>new</code>
method of any class makes a new instance.  Because
<code>pochi</code> is a <code>Dog</code> according to our class
definition, it has whatever properties we decided a <code>Dog</code>
should have.  Since our idea of <code>Dog</code>-ness was very
simple, there is just one trick we can ask <code>pochi</code> to
do.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> pochi.speak</b></font>
Bow Wow
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>Making a new instance of a class is sometimes called
<em>instantiating</em> that class.  We need to have a dog before we
can experience the pleasure of its conversation; we can't merely ask
the Dog <em>class</em> to bark for us.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> Dog.speak</b></font>
<font color="#50ffff"><b>ERR: (eval):1: undefined method `speak' for Dog:class</b></font></font></pre></td></tr></table>
<p>It makes no more sense than trying to <em>eat the concept of a
sandwich</em>.</p>
<p>On the other hand, if we want to hear the sound of a dog without
getting emotionally attached, we can create (instantiate) an ephemeral,
temporary dog, and coax a little noise out of it before it
disappears.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> (Dog.new).speak   # or more commonly, Dog.new.speak</b></font>
Bow Wow
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>"Wait," you say, "what's all this about the poor fellow
disappearing afterwards?" It's true: if we don't bother to give
it a name (as we did for <code>pochi</code>), ruby's automatic garbage
collection decides it is an unwanted stray dog, and mercilessly
disposes of it.  Really it's okay, you know, because we can make
all the dogs we want.</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="inheritance"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Inheritance</font></td><td width="10%">&nbsp;</td></tr></table>

<p>Our classification of objects in everyday life is naturally
hierarchical.  We know that <em>all cats are mammals</em>, and
<em>all mammals are animals</em>.  Smaller classes <em>inherit</em>
characteristics from the larger classes to which they belong.  If
all mammals breathe, then all cats breathe. </p>
<p>We can express this concept in ruby: </p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class Mammal</b></font>
    |<font color="#ffff00"><b>   def breathe</b></font>
    |<font color="#ffff00"><b>     print "inhale and exhale\n"</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> class Cat&lt;Mammal</b></font>
    |<font color="#ffff00"><b>   def speak</b></font>
    |<font color="#ffff00"><b>     print "Meow\n"</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>Though we didn't specify how a <code>Cat</code> should breathe, every
cat will inherit that behavior from the <code>Mammal</code> class since
<code>Cat</code> was defined as a subclass of <code>Mammal</code>.  (In
OO terminology, the smaller class is a <em>subclass</em> and the larger
class is a <em>superclass</em>.) Hence from a programmer's
standpoint, cats get the ability to breathe for free; after we add a
<code>speak</code> method, our cats can both breathe and speak.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> tama = Cat.new</b></font>
<font color="#50ffff"><b>   #&lt;Cat:0xbd80e8&gt;</b></font>
ruby&gt;<font color="#ffff00"><b> tama.breathe</b></font>
inhale and exhale
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> tama.speak</b></font>
Meow
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>There will be situations where certain properties of the superclass
should not be inherited by a particular subclass.  Though birds
generally know how to fly, penguins are a flightless subclass of
birds.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class Bird</b></font>
    |<font color="#ffff00"><b>   def preen</b></font>
    |<font color="#ffff00"><b>     print "I am cleaning my feathers."</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b>   def fly</b></font>
    |<font color="#ffff00"><b>     print "I am flying."</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> class Penguin&lt;Bird</b></font>
    |<font color="#ffff00"><b>   def fly</b></font>
    |<font color="#ffff00"><b>     fail "Sorry. I'd rather swim."</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>Rather than exhaustively define every characteristic of every
new class, we need only to append or to redefine the differences
between each subclass and its superclass.  This use of
inheritance is sometimes called <em>differential programming</em>.  
It is one of the benefits of object-oriented programming. </p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="redefinemethods"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Redefinition of methods</font></td><td width="10%">&nbsp;</td></tr></table>

<p>In a subclass, we can change the behavior of the instances by
redefining superclass methods.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class Human</b></font>
    |<font color="#ffff00"><b>   def identify</b></font>
    |<font color="#ffff00"><b>     print "I'm a person.\n"</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b>   def train_toll(age)</b></font>
    |<font color="#ffff00"><b>     if age &lt; 12</b></font>
    |<font color="#ffff00"><b>       print "Reduced fare.\n";</b></font>
    |<font color="#ffff00"><b>     else</b></font>
    |<font color="#ffff00"><b>       print "Normal fare.\n";</b></font>
    |<font color="#ffff00"><b>     end</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> Human.new.identify</b></font>
I'm a person.
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> class Student1&lt;Human</b></font>
    |<font color="#ffff00"><b>   def identify</b></font>
    |<font color="#ffff00"><b>     print "I'm a student.\n"</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> Student1.new.identify</b></font>
I'm a student.
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>Suppose we would rather enhance the superclass's <code>identify</code>
method than entirely replace it.  For this we can use <code>super</code>.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class Student2&lt;Human</b></font>
    |<font color="#ffff00"><b>   def identify</b></font>
    |<font color="#ffff00"><b>     super</b></font>
    |<font color="#ffff00"><b>     print "I'm a student too.\n"</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> Student2.new.identify</b></font>
I'm a human.
I'm a student too.
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p><code>super</code> lets us pass arguments to the original method.
It is sometimes said that there are two kinds of people...</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class Dishonest&lt;Human</b></font>
    |<font color="#ffff00"><b>   def train_toll(age)</b></font>
    |<font color="#ffff00"><b>     super(11) # we want a cheap fare.</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> Dishonest.new.train_toll(25)</b></font>
Reduced fare. 
<font color="#50ffff"><b>   nil</b></font>
<font color="#50ffff"><b></b></font>
ruby&gt;<font color="#ffff00"><b> class Honest&lt;Human</b></font>
    |<font color="#ffff00"><b>   def train_toll(age)</b></font>
    |<font color="#ffff00"><b>     super(age) # pass the argument we were given</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> Honest.new.train_toll(25)</b></font>
Normal fare. 
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="accesscontrol"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Access control</font></td><td width="10%">&nbsp;</td></tr></table>

<p>Earlier, we said that ruby has no functions, only methods.
However there is more than one kind of method.  In this chapter
we introduce <em>access controls</em>.</p>
<p>Consider what happens when we define a method in the "top level",
not inside a class definition.  We can think of such a method as
analogous to a <em>function</em> in a more traditional language like C.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> def square(n)</b></font>
    |<font color="#ffff00"><b>   n * n</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> square(5)</b></font>
<font color="#50ffff"><b>   25</b></font></font></pre></td></tr></table>
<p>Our new method would appear not to belong to any class, but in fact
ruby gives it to the <code>Object</code> class, which is a superclass
of every other class.  As a result, any object should now be able
to use that method.  That turns out to be true, but there's a
small catch: it is a <em>private</em> method of every class.
We'll discuss some of what this means below, but one consequence is
that it may be invoked only in function style, as here:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class Foo</b></font>
    |<font color="#ffff00"><b>   def fourth_power_of(x)</b></font>
    |<font color="#ffff00"><b>     square(x) * square(x)</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
  nil
ruby&gt;<font color="#ffff00"><b> Foo.new.fourth_power_of 10</b></font>
  10000</font></pre></td></tr></table>
<p>We are not allowed to explicitly apply the method to an object:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> "fish".square(5)</b></font>
<font color="#50ffff"><b>ERR: (eval):1: private method `square' called for "fish":String</b></font></font></pre></td></tr></table>
<p>This rather cleverly preserves ruby's pure-OO nature (functions are
still object methods, but the receiver is <code>self</code>
implicitly) while providing functions that can be written just as in a
more traditional language.</p>
<p>A common mental discipline in OO programming, which we have hinted
at in an earlier chapter, concerns the separation of
<em>specification</em> and <em>implementation</em>, or <em>what</em> tasks an
object is supposed to accomplish and <em>how</em> it actually
accomplishes them.  The internal workings of an object should be
kept generally hidden from its users; they should only care about what
goes in and what comes out, and trust the object to know what it is
doing internally.  As such it is often helpful for classes to
have methods that the outside world does not see, but which are used
internally (and can be improved by the programmer whenever desired,
without changing the way users see objects of that class).  In
the trivial example below, think of <code>engine</code> as the invisible
inner workings of the class.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class Test</b></font>
    |<font color="#ffff00"><b>   def times_two(a)</b></font>
    |<font color="#ffff00"><b>     print a," times two is ",engine(a),"\n"</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b>   def engine(b)</b></font>
    |<font color="#ffff00"><b>     b*2</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b>   private:engine  # this hides engine from users</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   Test</b></font>
ruby&gt;<font color="#ffff00"><b> test = Test.new</b></font>
<font color="#50ffff"><b>   #&lt;Test:0x4017181c&gt;</b></font>
ruby&gt;<font color="#ffff00"><b> test.engine(6)</b></font>
<font color="#50ffff"><b>ERR: (eval):1: private method `engine' called for #&lt;Test:0x4017181c&gt;</b></font>
ruby&gt;<font color="#ffff00"><b> test.times_two(6)</b></font>
6 times two is 12.
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>We might have expected <code>test.engine(6)</code> to return 12, but
instead we learn that <code>engine</code> is inaccessible when we
are acting as a user of a <code>Test</code> object.  Only other
<code>Test</code> methods, such as <code>times_two</code>, are allowed to
use <code>engine</code>.  We are required to go through the
public interface, which consists of the <code>times_two</code>
method.  The programmer who is in charge of this class can change
<code>engine</code> freely (here, perhaps by changing <code>b*2</code>
to <code>b+b</code>, assuming for the sake of argument that it improved
performance) without affecting how the user interacts with
<code>Test</code> objects.  This example is of course much too simple
to be useful; the benefits of access controls become more clear only
when we begin to create more complicated and interesting classes.</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="singletonmethods"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Singleton methods</font></td><td width="10%">&nbsp;</td></tr></table>

<p>The behavior of an instance is determined by its class, but there
may be times we know that a particular instance should have special
behavior.  In most languages, we must go to the trouble of
defining another class, which would then only be instantiated
once.  In ruby we can give any object its own methods.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class SingletonTest</b></font>
    |<font color="#ffff00"><b>   def size</b></font>
    |<font color="#ffff00"><b>     print "25\n"</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> test1 = SingletonTest.new</b></font>
<font color="#50ffff"><b>   #&lt;SingletonTest:0xbc468&gt;</b></font>
ruby&gt;<font color="#ffff00"><b> test2 = SingletonTest.new</b></font>
<font color="#50ffff"><b>   #&lt;SingletonTest:0xbae20&gt;</b></font>
ruby&gt;<font color="#ffff00"><b> def test2.size</b></font>
    |<font color="#ffff00"><b>   print "10\n"</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> test1.size</b></font>
25
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> test2.size</b></font>
10
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>In this example, <code>test1</code> and <code>test2</code> belong to
same class, but <code>test2</code> has been given a redefined
<code>size</code> method and so they behave differently.  A method
given only to a single object is called a <em>singleton method</em>.</p>
<p>Singleton methods are often used for elements of a graphic user
interface (GUI), where different actions need to be taken when
different buttons are pressed.</p>
<p>Singleton methods are not unique to ruby, as they appear in CLOS,
Dylan, etc.  Also, some languages, for example, Self and
NewtonScript, have singleton methods only.  These are sometimes
called <em>prototype-based</em> languages. </p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="modules"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Modules</font></td><td width="10%">&nbsp;</td></tr></table>

<p>Modules in ruby are similar to classes, except:</p>
<ul>
<li>A module can have no instances.</li>
<li>A module can have no subclasses.</li>
<li>A module is defined by <code>module ... end</code>.</li>
</ul>
<p>Actually... the Module class of module is the superclass of the
Class class of class.  Got that? No? Let's move
on. </p>
<p>There are two typical uses of modules.  One is to collect
related methods and constants in a central location.  The
<code>Math</code> module in ruby's standard library plays such a
role:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> Math.sqrt(2)</b></font>
<font color="#50ffff"><b>   1.41421</b></font>
ruby&gt;<font color="#ffff00"><b> Math::PI</b></font>
<font color="#50ffff"><b>   3.14159</b></font></font></pre></td></tr></table>
<p>The <code>::</code> operator tells the ruby interpreter which module it
should consult for the value of a constant (conceivably, some module
besides <code>Math</code> might mean something else by <code>PI</code>).
If we want to refer to the methods or constants of a module directly
without using <code>::</code>, we can <code>include</code> that module:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> include Math</b></font>
<font color="#50ffff"><b>   Object</b></font>
ruby&gt;<font color="#ffff00"><b> sqrt(2)</b></font>
<font color="#50ffff"><b>   1.41421</b></font>
ruby&gt;<font color="#ffff00"><b> PI</b></font>
<font color="#50ffff"><b>   3.14159</b></font></font></pre></td></tr></table>
<p>Another use of modules is called <em>mixin</em>.  Some OO
programming langages, including C++, allow <em>multiple
inheritance</em>, that is, inheritance from more than one
superclass.  A real-world example of multiple inheritance is an
alarm clock; you can think of alarm clocks as belonging to the class
of <em>clocks</em> and also the class of <em>things with
buzzers</em>.</p>
<p>Ruby purposely does not implement true multiple inheritance, but
the <em>mixin</em> technique is a good alternative.  Remember that
modules cannot be instantiated or subclassed; but if we
<code>include</code> a module in a class definition, its methods are
effectively appended, or "mixed in", to the class.</p>
<p>Mixin can be thought of as a way of asking for whatever particular
properties we want to have.  For example, if a class has a
working <code>each</code> method, mixing in the standard library's
<code>Enumerable</code> module gives us <code>sort</code> and
<code>find</code> methods for free.</p>
<p>This use of modules gives us the basic functionality of multiple
inheritance but allows us to represent class relationships with a
simple tree structure, and so simplifies the language implementation
considerably (a similar choice was made by the designers of Java).</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="procobjects"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Procedure objects</font></td><td width="10%">&nbsp;</td></tr></table>

<p>It is often desirable to be able to specify responses to unexpected
events.  As it turns out, this is most easily done if we can pass
blocks of code as arguments to other methods, which means we want to
be able to treat code as if it were data.</p>
<p>A new <em>procedure object</em> is formed using <code>proc</code>:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> quux = proc {</b></font>
    |<font color="#ffff00"><b>   print "QUUXQUUXQUUX!!!\n"</b></font>
    |<font color="#ffff00"><b> }</b></font>
<font color="#50ffff"><b>   #&lt;Proc:0x4017357c&gt;</b></font></font></pre></td></tr></table>
<p>Now what <code>quux</code> refers to is an object, and like most
objects, it has behavior that can be evoked.  Specifically, we
can ask it to execute, via its <code>call</code> method:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> quux.call</b></font>
QUUXQUUXQUUX!!!
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>So, after all that, can <code>quux</code> be used as a method
argument? Sure.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> def run( p )</b></font>
    |<font color="#ffff00"><b>   print "About to call a procedure...\n"</b></font>
    |<font color="#ffff00"><b>   p.call</b></font>
    |<font color="#ffff00"><b>   print "There: finished.\n"</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> run quux</b></font>
About to call a procedure...
QUUXQUUXQUUX!!!
There: finished.
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>The <code>trap</code> method lets us assign the response of our choice
to any system signal.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> inthandler = proc{ print "^C was pressed.\n" }</b></font>
<font color="#50ffff"><b>   #&lt;Proc:0x401730a4&gt;</b></font>
ruby&gt;<font color="#ffff00"><b> trap "SIGINT", inthandler</b></font>
<font color="#50ffff"><b>   #&lt;Proc:0x401735e0&gt;</b></font></font></pre></td></tr></table>
<p>Normally pressing <em>^C</em> makes the interpreter quit.  Now a
message is printed and the interpreter continues running, so you don't
lose the work you were doing.  (You're not trapped in the
interpreter forever; you can still exit by typing <code>exit</code> or
pressing <em>^D</em>.)</p>
<p>A final note before we move on to other topics: it's not strictly
necessary to give a procedure object a name before binding it to a
signal.  An equivalent <em>anonymous</em> procedure object would
look like</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> trap "SIGINT", proc{ print "^C was pressed.\n" }</b></font>
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>or more compactly still,</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> trap "SIGINT", 'print "^C was pressed.\n"'</b></font>
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>This abbreviated form provides some convenience and readability
when you write small anonymous procedures.</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="variables"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Variables</font></td><td width="10%">&nbsp;</td></tr></table>

<p>Ruby has three kinds of variables, one kind of constant and
exactly two pseudo-variables.  The variables and the constants
have no type.  While untyped variables have some drawbacks, they
have many more advantages and fit well with ruby's <em>quick and
easy</em> philosophy.</p>
<p>Variables must be declared in most languages in order to specify
their type, modifiability (i.e., whether they are constants), and
scope; since type is not an issue, and the rest is evident from the
variable name as you are about to see, we do not need variable
declarations in ruby.</p>
<p>The first character of an identifier categorizes it at a glance:</p>
<p><table border="1"><tr><td><code>$</code> </td><td> global variable </td></tr>
<tr><td>
<code>@</code> </td><td> instance variable </td></tr>
<tr><td>
<code>[a-z]</code> or <code>_</code> </td><td> local variable </td></tr>
<tr><td>
<code>[A-Z]</code> </td><td> constant</td></tr></table>
<p>The only exceptions to the above are ruby's pseudo-variables:
<code>self</code>, which always refers to the currently executing
object, and <code>nil</code>, which is the meaningless value assigned
to uninitialized variables.  Both are named as if they are local
variables, but <code>self</code> is a global variable maintained by
the interpreter, and <code>nil</code> is really a constant.  As
these are the only two exceptions, they don't confuse things too
much.</p>
<p>You man not assign values to <code>self</code> or <code>nil</code>. <code>main</code>, as a
value of <code>self</code>, refers to the top-level object:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> self</b></font>
<font color="#50ffff"><b>   main</b></font>
ruby&gt;<font color="#ffff00"><b> nil</b></font>
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="globalvars"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Global variables</font></td><td width="10%">&nbsp;</td></tr></table>

<p>A global variable has a name beginning with <code>$</code>.  It
can be referred to from anywhere in a program.  Before
initialization, a global variable has the special value
<code>nil</code>. </p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> $foo</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> $foo = 5</b></font>
<font color="#50ffff"><b>   5</b></font>
ruby&gt;<font color="#ffff00"><b> $foo</b></font>
<font color="#50ffff"><b>   5</b></font></font></pre></td></tr></table>
<p>Global variables should be used sparingly.  They are dangerous
because they can be written to from anywhere.  Overuse of globals
can make isolating bugs difficult; it also tends to indicate that the
design of a program has not been carefully thought out.  Whenever
you do find it necessary to use a global variable, be sure to give it
a descriptive name that is unlikely to be inadvertently used for
something else later (calling it something like <code>$foo</code> as
above is probably a bad idea).</p>
<p>One nice feature of a global variable is that it can be traced; you
can specify a procedure which is invoked whenever the value of the
variable is changed. </p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> trace_var :$x, proc{print "$x is now ", $x, "\n"}</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> $x = 5</b></font>
$x is now 5
<font color="#50ffff"><b>   5</b></font></font></pre></td></tr></table>
<p>When a global variable has been rigged to work as a trigger to
invoke a procedure whenever changed, we sometimes call it an <em>active
variable</em>.  For instance, it is useful for keeping a GUI
display up to date.</p>
<p>There is a collection of special variables whose names consist of a
dollar sign (<code>$</code>) followed by a single character.  For example,
<code>$$</code> contains the process id of the ruby interpreter, and is
read-only.  Here are the major system variables and their meanings
(see the ruby
<a href="http://www.ruby-lang.org/en/man-1.4/">reference manual</a>
for details):</p>
<p><table border="1"><tr><td><code>$!</code> </td><td> latest error message </td></tr>
<tr><td>
<code>$@</code> </td><td> location of error </td></tr>
<tr><td>
<code>$_</code> </td><td> string last read by <code>gets</code> </td></tr>
<tr><td>
<code>$.</code> </td><td> line <em>number</em> last read by interpreter </td></tr>
<tr><td>
<code>$&amp;</code> </td><td> string last matched by regexp </td></tr>
<tr><td>
<code>$~</code> </td><td> the last regexp match, as an array of subexpressions </td></tr>
<tr><td>
<code>$</code><em>n</em> </td><td> the <em>nth</em> subexpression in the last match (same as <code>$~[</code><em>n</em><code>]</code>) </td></tr>
<tr><td>
<code>$=</code> </td><td> case-insensitivity flag </td></tr>
<tr><td>
<code>$/</code> </td><td> input record separator </td></tr>
<tr><td>
<code>$\</code> </td><td> output record separator </td></tr>
<tr><td>
<code>$0</code> </td><td> the name of the ruby script file </td></tr>
<tr><td>
<code>$*</code> </td><td> the command line arguments </td></tr>
<tr><td>
<code>$$</code> </td><td> interpreter's process ID </td></tr>
<tr><td>
<code>$?</code> </td><td> exit status of last executed child process</td></tr></table>
<p>In the above, <code>$_</code> and <code>$~</code> have local scope.
Their names suggest they should be global, but they are much more
useful this way, and there are historical reasons for using these
names.</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="instancevars"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Instance variables</font></td><td width="10%">&nbsp;</td></tr></table>

<p>An instance variable has a name beginning with <code>@</code>, and its
scope is confined to whatever object <code>self</code> refers to.
Two different objects, even if they belong to the same class, are
allowed to have different values for their instance variables.
From outside the object, instance variables cannot be altered or even
observed (i.e., ruby's instance variables are never <em>public</em>)
except by whatever methods are explicitly provided by the
programmer.  As with globals, instance variables have the
<code>nil</code> value until they are initialized.</p>
<p>Instance variables of ruby do not need declaration.  This
implies a flexible structure of objects.  In fact, each instance
variable is dynamically appended to an object when it is first
referenced.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class InstTest</b></font>
    |<font color="#ffff00"><b>   def set_foo(n)</b></font>
    |<font color="#ffff00"><b>     @foo = n</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b>   def set_bar(n)</b></font>
    |<font color="#ffff00"><b>     @bar = n</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> i = InstTest.new</b></font>
<font color="#50ffff"><b>   #&lt;InstTest:0x83678&gt;</b></font>
ruby&gt;<font color="#ffff00"><b> i.set_foo(2)</b></font>
<font color="#50ffff"><b>   2</b></font>
ruby&gt;<font color="#ffff00"><b> i</b></font>
<font color="#50ffff"><b>   #&lt;InstTest:0x83678 @foo=2&gt;</b></font>
ruby&gt;<font color="#ffff00"><b> i.set_bar(4)</b></font>
<font color="#50ffff"><b>   4</b></font>
ruby&gt;<font color="#ffff00"><b> i</b></font>
<font color="#50ffff"><b>   #&lt;InstTest:0x83678 @foo=2, @bar=4&gt;</b></font></font></pre></td></tr></table>
<p>Notice above that <code>i</code> does not report a value for
<code>@bar</code> until after the <code>set_bar</code> method is
invoked.</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="localvars"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Local variables</font></td><td width="10%">&nbsp;</td></tr></table>

<p>A local variable has a name starting with a lower case letter or an
underscore character (<code>_</code>).  Local variables do
not, like globals and instance variables, have the value
<code>nil</code> before initialization:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> $foo</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> @foo</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> foo</b></font>
<font color="#50ffff"><b>ERR: (eval):1: undefined local variable or method `foo' for main(Object)</b></font></font></pre></td></tr></table>
<p>The first assignment you make to a local variable acts something
like a declaration.  If you refer to an uninitialized local
variable, the ruby interpreter thinks of it as an attempt to invoke a
method of that name; hence the error message you see above.</p>
<p>Generally, the scope of a local variable is one of</p>
<ul>
<li><code>proc{</code> ... <code>}</code></li>
<li><code>loop{</code> ... <code>}</code></li>
<li><code>def</code> ... <code>end</code></li>
<li><code>class</code> ... <code>end</code></li>
<li><code>module</code> ... <code>end</code></li>
<li>the entire program (unless one of the above applies)</li>
</ul>
<p>In the next example,<code> defined? </code>is an operator which checks
whether an identifier is defined.  It returns a description of the
identifier if it is defined, or <code>nil</code> otherwise.  As you see,
<code>bar</code>'s scope is local to the loop; when the loop exits, <code>bar</code>
is undefined.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> foo = 44; print foo, "\n"; defined? foo</b></font>
44
<font color="#50ffff"><b>   "local-variable"</b></font>
ruby&gt;<font color="#ffff00"><b> loop{bar=45; print bar, "\n"; break}; defined? bar</b></font>
45
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>Procedure objects that live in the same scope share whatever local
variables also belong to that scope.  Here, the local variable
<code>bar</code> is shared by <code>main</code> and the procedure objects
<code>p1</code> and <code>p2</code>:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> bar=0</b></font>
<font color="#50ffff"><b>   0</b></font>
ruby&gt;<font color="#ffff00"><b> p1 = proc{|n| bar=n}</b></font>
<font color="#50ffff"><b>   #&lt;Proc:0x8deb0&gt;</b></font>
ruby&gt;<font color="#ffff00"><b> p2 = proc{bar}</b></font>
<font color="#50ffff"><b>   #&lt;Proc:0x8dce8&gt;</b></font>
ruby&gt;<font color="#ffff00"><b> p1.call(5)</b></font>
<font color="#50ffff"><b>   5</b></font>
ruby&gt;<font color="#ffff00"><b> bar</b></font>
<font color="#50ffff"><b>   5</b></font>
ruby&gt;<font color="#ffff00"><b> p2.call</b></font>
<font color="#50ffff"><b>   5</b></font></font></pre></td></tr></table>
<p>Note that the "<code>bar=0</code>" at the beginning cannot be omitted;
that assignment ensures that the scope of <code>bar</code> will encompass
<code>p1</code> and <code>p2</code>.  Otherwise <code>p1</code> and
<code>p2</code> would each end up with its own local variable
<code>bar</code>, and calling <code>p2</code> would have resulted in that
"undefined local variable or method" error.</p>
<p>A powerful feature of procedure objects follows from their ability
to be passed as arguments: shared local variables remain valid even
when they are passed out of the original scope.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> def box</b></font>
    |<font color="#ffff00"><b>   contents = 15</b></font>
    |<font color="#ffff00"><b>   get = proc{contents}</b></font>
    |<font color="#ffff00"><b>   set = proc{|n| contents = n}</b></font>
    |<font color="#ffff00"><b>   return get, set</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> reader, writer = box</b></font>
<font color="#50ffff"><b>   [#&lt;Proc:0x40170fc0&gt;, #&lt;Proc:0x40170fac&gt;] </b></font>
ruby&gt;<font color="#ffff00"><b> reader.call</b></font>
<font color="#50ffff"><b>   15</b></font>
ruby&gt;<font color="#ffff00"><b> writer.call(2)</b></font>
<font color="#50ffff"><b>   2</b></font>
ruby&gt;<font color="#ffff00"><b> reader.call</b></font>
<font color="#50ffff"><b>   2</b></font></font></pre></td></tr></table>
<p>Ruby is particularly smart about scope.  It is evident in our
example that the <code>contents</code> variable is being shared between the
<code>reader</code> and <code>writer</code>.  But we can also manufacture
multiple reader-writer pairs using <code>box</code> as defined above; each
pair shares a <code>contents</code> variable, and the pairs do not interfere
with each other.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> reader_1, writer_1 = box</b></font>
<font color="#50ffff"><b>   [#&lt;Proc:0x40172820&gt;, #&lt;Proc:0x4017280c&gt;]</b></font>
ruby&gt;<font color="#ffff00"><b> reader_2, writer_2 = box</b></font>
<font color="#50ffff"><b>   [#&lt;Proc:0x40172668&gt;, #&lt;Proc:0x40172654&gt;]</b></font>
ruby&gt;<font color="#ffff00"><b> writer_1.call(99)</b></font>
<font color="#50ffff"><b>   99</b></font>
ruby&gt;<font color="#ffff00"><b> reader_1.call</b></font>
<font color="#50ffff"><b>   99</b></font>
ruby&gt;<font color="#ffff00"><b> reader_2.call</b></font>
<font color="#50ffff"><b>   15</b></font></font></pre></td></tr></table>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="constants"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Class constants</font></td><td width="10%">&nbsp;</td></tr></table>

<p>A constant has a name starting with an uppercase character.  It should
be assigned a value at most once. In the current implementation of
ruby, reassignment of a constant generates a warning but not an error
(the non-ANSI version of eval.rb does not report the warning):</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b>fluid=30</b></font>
<font color="#50ffff"><b>   30</b></font>
ruby&gt;<font color="#ffff00"><b>fluid=31</b></font>
<font color="#50ffff"><b>   31</b></font>
ruby&gt;<font color="#ffff00"><b>Solid=32</b></font>
<font color="#50ffff"><b>   32</b></font>
ruby&gt;<font color="#ffff00"><b>Solid=33</b></font>
<font color="#50ffff"><b>   (eval):1: warning: already initialized constant Solid</b></font>
<font color="#50ffff"><b>   33</b></font></font></pre></td></tr></table>
<p>Constants may be defined within classes, but unlike instance
variables, they are accessible outside the class.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class ConstClass</b></font>
    |<font color="#ffff00"><b>   C1=101</b></font>
    |<font color="#ffff00"><b>   C2=102</b></font>
    |<font color="#ffff00"><b>   C3=103</b></font>
    |<font color="#ffff00"><b>   def show</b></font>
    |<font color="#ffff00"><b>     print C1," ",C2," ",C3,"\n"</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> C1</b></font>
<font color="#50ffff"><b>ERR: (eval):1: uninitialized constant C1</b></font>
ruby&gt;<font color="#ffff00"><b> ConstClass::C1</b></font>
<font color="#50ffff"><b>   101</b></font>
ruby&gt;<font color="#ffff00"><b> ConstClass.new.show</b></font>
101 102 103
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>
<p>Constants can also be defined in modules.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> module ConstModule</b></font>
    |<font color="#ffff00"><b>   C1=101</b></font>
    |<font color="#ffff00"><b>   C2=102</b></font>
    |<font color="#ffff00"><b>   C3=103</b></font>
    |<font color="#ffff00"><b>   def showConstants</b></font>
    |<font color="#ffff00"><b>     print C1," ",C2," ",C3,"\n"</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> C1</b></font>
<font color="#50ffff"><b>ERR: (eval):1: uninitialized constant C1</b></font>
ruby&gt;<font color="#ffff00"><b> include ConstModule</b></font>
<font color="#50ffff"><b>   Object</b></font>
ruby&gt;<font color="#ffff00"><b> C1</b></font>
<font color="#50ffff"><b>   101</b></font>
ruby&gt;<font color="#ffff00"><b> showConstants</b></font>
101 102 103
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> C1=99  # not really a good idea</b></font>
<font color="#50ffff"><b>   99</b></font>
ruby&gt;<font color="#ffff00"><b> C1</b></font>
<font color="#50ffff"><b>   99</b></font>
ruby&gt;<font color="#ffff00"><b> ConstModule::C1  # the module's constant is undisturbed ...</b></font>
<font color="#50ffff"><b>   101</b></font>
ruby&gt;<font color="#ffff00"><b> ConstModule::C1=99 </b></font>
<font color="#50ffff"><b>ERR: (eval):1: compile error</b></font>
<font color="#50ffff"><b>(eval):1: parse error</b></font>
<font color="#50ffff"><b>ConstModule::C1=99</b></font>
<font color="#50ffff"><b>                ^</b></font>
ruby&gt;<font color="#ffff00"><b> ConstModule::C1  # .. regardless of how we tamper with it.</b></font>
<font color="#50ffff"><b>   101</b></font></font></pre></td></tr></table>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="rescue"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Exception processing: rescue</font></td><td width="10%">&nbsp;</td></tr></table>

<p>An executing program can run into unexpected problems.  A file
that it it wants to read might not exist; the disk might be full when
it wants to save some data; the user may provide it with some
unsuitable kind of input.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> file = open("some_file")</b></font>
<font color="#50ffff"><b>ERR: (eval):1:in `open': No such file or directory - some_file</b></font></font></pre></td></tr></table>
<p>A robust program will handle these situations sensibly and
gracefully.  Meeting that expectation can be an exasperating
task.  C programmers are expected to check the result of every
system call that could possibly fail, and immediately decide what is
to be done:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#d8d8e0"><tr><td><pre><font color="black">FILE *file = fopen("some_file", "r");
if (file == NULL) {
  fprintf( stderr, "File doesn't exist.\n" );
  exit(1);
}
bytes_read = fread( buf, 1, bytes_desired, file );
if (bytes_read != bytes_desired ) {
  /* do more error handling here ... */
}
...</font></pre></td></tr></table>
<p>This is such a tiresome practice that programmers can tend to grow
careless and neglect it, and the result is a program that doesn't
handle exceptions well.  On the other hand, doing the job right
can make programs hard to read, because there is so much error
handling cluttering up the meaningful code.</p>
<p>In ruby, as in many modern languages, we can handle exceptions for
blocks of code in a compartmentalized way, thus dealing with surprises
effectively but not unduly burdening either the programmer or anyone
else trying to read the code later.  The block of code marked
with <code>begin</code> executes until there is an exception, which causes
control to be transferred to a block of error handling code, which is
marked with <code>rescue</code>.  If no exception occurs, the
<code>rescue</code> code is not used.  The following method returns
the first line of a text file, or <code>nil</code> if there is an
exception:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">def first_line( filename )
  begin
    file = open("some_file")
    info = file.gets
    file.close
    info  # Last thing evaluated is the return value
  rescue
    nil   # Can't read the file? then don't return a string
  end
end</font></pre></td></tr></table>
<p>There will be times when we would like to be able to creatively
work around a problem.  Here, if the file we want is unavailable,
we try to use standard input instead:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">begin
  file = open("some_file")
rescue
  file = STDIN
end

begin
  # ... process the input ...
rescue
  # ... and deal with any other exceptions here.
end</font></pre></td></tr></table>
<p><code>retry</code> can be used in the <code>rescue</code> code to start the
<code>begin</code> code over again.  It lets us rewrite the previous
example a little more compactly:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">fname = "some_file"
begin
  file = open(fname)
  # ... process the input ...
rescue
  fname = "STDIN"
  retry
end</font></pre></td></tr></table>
<p>However, there is a flaw here.  A nonexistent file will make
this code retry in an infinite loop.  You need to watch out for
such pitfalls when using <code>retry</code> for exception processing. </p>
<p>Every ruby library raises an exception if any error occurs, and you
can raise exceptions explicitly in your code too.  To raise an
exception, use <code>raise</code>.  It takes one argument, which
should be a string that describes the exception.  The argument is
optional but should not be omitted.  It can be accessed later via
the special global variable <code>$!</code>.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> raise "test error"</b></font>
<font color="#50ffff"><b>   test error</b></font>
ruby&gt;<font color="#ffff00"><b> begin</b></font>
    |<font color="#ffff00"><b>   raise "test2"</b></font>
    |<font color="#ffff00"><b> rescue</b></font>
    |<font color="#ffff00"><b>   print "An error occurred: ",$!, "\n"</b></font>
    |<font color="#ffff00"><b> end</b></font>
An error occurred: test2
<font color="#50ffff"><b>   nil</b></font></font></pre></td></tr></table>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="ensure"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Exception processing: ensure</font></td><td width="10%">&nbsp;</td></tr></table>

<p>There may be cleanup work that is necessary when a method finishes
its work.  Perhaps an open file should be closed, buffered data
should be flushed, etc.  If there were always only one exit point
for each method, we could confidently put our cleanup code in one
place and know that it would be executed; however, a method might
return from several places, or our intended cleanup code might be
unexpectedly skipped because of an exception.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">begin
  file = open("/tmp/some_file", "w")
  # ... write to the file ...
  file.close
end</font></pre></td></tr></table>
<p>In the above, if an exception occurred during the section of code
where we were writing to the file, the file would be left open.
And we don't want to resort to this kind of redundancy:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">begin
  file = open("/tmp/some_file", "w")
  # ... write to the file ...
  file.close
rescue
  file.close
  fail # raise an exception
end</font></pre></td></tr></table>
<p>It's clumsy, and gets out of hand when the code gets more
complicated because we have to deal with every <code>return</code> and
<code>break</code>.</p>
<p>For this reason we add another keyword to the
"<code>begin...rescue...end</code>" scheme, which is
<code>ensure</code>.  The <code>ensure</code> code block executes
regardless of the success or failure of the <code>begin</code> block.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">begin
  file = open("/tmp/some_file", "w")
  # ... write to the file ...
rescue
  # ... handle the exceptions ...
ensure
  file.close   # ... and this always happens.
end</font></pre></td></tr></table>
<p>It is possible to use <code>ensure</code> without
<code>rescue</code>, or vice versa, but if they are used together in
the same<code> begin...end </code>block, the <code>rescue</code> must
precede the <code>ensure</code>.</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="accessors"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Accessors</font></td><td width="10%">&nbsp;</td></tr></table>

<h3><a name="label:0" id="label:0">What is an accessor?</a></h3><!-- RDLabel: "What is an accessor?" -->
<p>We briefly discussed instance variables in an earlier chapter, but
haven't done much with them yet.  An object's instance variables are
its attributes, the things that generally distinguish it from other
objects of the same class.  It is important to be able to write and
read these attributes; doing so requires writing methods called
<em>attribute accessors</em>.  We'll see in a moment that we don't
always have to write accessor methods explicitly, but let's go through
all the motions for now.  The two kinds of accessors are
<em>writers</em> and <em>readers</em>.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class Fruit</b></font>
    |<font color="#ffff00"><b>   def set_kind(k)  # a writer</b></font>
    |<font color="#ffff00"><b>     @kind = k</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b>   def get_kind     # a reader</b></font>
    |<font color="#ffff00"><b>     @kind</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> f1 = Fruit.new</b></font>
<font color="#50ffff"><b>   #&lt;Fruit:0xfd7e7c8c&gt;</b></font>
ruby&gt;<font color="#ffff00"><b> f1.set_kind("peach")  # use the writer</b></font>
<font color="#50ffff"><b>   "peach"</b></font>
ruby&gt;<font color="#ffff00"><b> f1.get_kind           # use the reader</b></font>
<font color="#50ffff"><b>   "peach"</b></font>
ruby&gt;<font color="#ffff00"><b> f1                    # inspect the object</b></font>
<font color="#50ffff"><b>   #&lt;Fruit:0xfd7e7c8c @kind="peach"&gt;</b></font></font></pre></td></tr></table>
<p>Simple enough; we can store and retrieve information about
what kind of fruit we're looking at.  But our method names are a
little wordy.  The following is more concise, and more
conventional:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class Fruit</b></font>
    |<font color="#ffff00"><b>   def kind=(k)</b></font>
    |<font color="#ffff00"><b>     @kind = k</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b>   def kind</b></font>
    |<font color="#ffff00"><b>     @kind</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> f2 = Fruit.new</b></font>
<font color="#50ffff"><b>   #&lt;Fruit:0xfd7e7c8c&gt;</b></font>
ruby&gt;<font color="#ffff00"><b> f2.kind = "banana"</b></font>
<font color="#50ffff"><b>   "banana"</b></font>
ruby&gt;<font color="#ffff00"><b> f2.kind</b></font>
<font color="#50ffff"><b>   "banana"</b></font></font></pre></td></tr></table>
<h3><a name="label:1" id="label:1">The <code>inspect</code> method</a></h3><!-- RDLabel: "The inspect method" -->
<p>A short digression is in order.  You've noticed by now that when we 
try to look at an object directly, we are shown something cryptic like
<code>#&lt;anObject:0x83678&gt;</code>.  This is just a default
behavior, and we are free to change it.  All we need to do is add
a method named <code>inspect</code>.  It should return a string
that describes the object in some sensible way, including the
states of some or all of its instance variables.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class Fruit</b></font>
    |<font color="#ffff00"><b>   def inspect</b></font>
    |<font color="#ffff00"><b>     "a fruit of the " + @kind + " variety"</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> f2</b></font>
<font color="#50ffff"><b>   "a fruit of the banana variety"</b></font></font></pre></td></tr></table>
<p>A related method is <code>to_s</code> (convert to string), which is
used when printing an object.  In general, you can think of
<code>inspect</code> as a tool for when you are writing and debugging
programs, and <code>to_s</code> as a way of refining program output.
<code>eval.rb</code> uses <code>inspect</code> whenever it displays
results.  You can use the <code>p</code> method to easily get
debugging output from programs.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black"># These two lines are equivalent:
p anObject
print anObject.inspect, "\n"</font></pre></td></tr></table>
<h3><a name="label:2" id="label:2">Making accessors the easy way</a></h3><!-- RDLabel: "Making accessors the easy way" -->
<p>Since many instance variables need accessor methods, Ruby provides
convenient shortcuts for the standard forms.</p>
<p><table border="1"><tr><td><em> Shortcut </em> </td><td> <em> Effect </em> </td></tr>
<tr><td>
<code> attr_reader :v </code> </td><td> <code> def v; @v; end </code> </td></tr>
<tr><td>
<code> attr_writer :v </code> </td><td> <code> def v=(value); @v=value; end </code> </td></tr>
<tr><td>
<code> attr_accessor :v </code> </td><td> <code> attr_reader :v; attr_writer :v </code> </td></tr>
<tr><td>
<code> attr_accessor :v, :w </code> </td><td> <code> attr_accessor :v; attr_accessor :w </code></td></tr></table>
<p>Let's take advantage of this and add freshness information.  First
we ask for an automatically generated reader and writer, and then we
incorporate the new information into <code>inspect</code>:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class Fruit</b></font>
    |<font color="#ffff00"><b>   attr_accessor :condition</b></font>
    |<font color="#ffff00"><b>   def inspect</b></font>
    |<font color="#ffff00"><b>     "a " + @condition + @kind"</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> f2.condition = "ripe"</b></font>
<font color="#50ffff"><b>   "ripe"</b></font>
ruby&gt;<font color="#ffff00"><b> f2</b></font>
<font color="#50ffff"><b>   "a ripe banana"</b></font></font></pre></td></tr></table>
<h3><a name="label:3" id="label:3">More fun with fruit</a></h3><!-- RDLabel: "More fun with fruit" -->
<p>If nobody eats our ripe fruit, perhaps we should let time take its
toll.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class Fruit</b></font>
    |<font color="#ffff00"><b>   def time_passes</b></font>
    |<font color="#ffff00"><b>     @condition = "rotting"</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> f2</b></font>
<font color="#50ffff"><b>   "a ripe banana"</b></font>
ruby&gt;<font color="#ffff00"><b> f2.time_passes</b></font>
<font color="#50ffff"><b>   "rotting"</b></font>
ruby&gt;<font color="#ffff00"><b> f2</b></font>
<font color="#50ffff"><b>   "a rotting banana"</b></font></font></pre></td></tr></table>
<p>But while playing around here, we have introduced a small problem.
What happens if we try to create a third piece of fruit now?  Remember
that instance variables don't exist until values are assigned to
them.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> f3 = Fruit.new</b></font>
<font color="#50ffff"><b>ERR: failed to convert nil into String</b></font></font></pre></td></tr></table>
<p>It is the <code>inspect</code> method that is complaining here, and
with good reason.  We have asked it to report on the kind and
condition of a piece of fruit, but as yet <code>f3</code> has not been
assigned either attribute.  If we wanted to, we could rewrite the
<code>inspect</code> method so it tests instance variables using
the<code> defined? </code>method and then only reports on them if they
exist, but maybe that's not very useful; since every piece of fruit
has a kind and condition, it seems we should make sure those always
get defined somehow.  That is the topic of the next chapter.</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="objinitialization"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Object initialization</font></td><td width="10%">&nbsp;</td></tr></table>

<p>Our Fruit class from the previous chapter had two instance variables,
one to describe the kind of fruit and another to describe its
condition.  It was only after writing a custom <code>inspect</code>
method for the class that we realized it didn't make sense for a piece
of fruit to lack those characteristics.  Fortunately, ruby provides a
way to ensure that instance variables always get initialized.</p>
<h3><a name="label:0" id="label:0">The <code>initialize</code> method</a></h3><!-- RDLabel: "The initialize method" -->
<p>Whenever Ruby creates a new object, it looks for a method named
<code>initialize</code> and executes it.  So one simple thing we can
do is use an <code>initialize</code> method to put default values into
all the instance variables, so the <code>inspect</code> method will
have something to say.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class Fruit</b></font>
    |<font color="#ffff00"><b>   def initialize</b></font>
    |<font color="#ffff00"><b>     @kind = "apple"</b></font>
    |<font color="#ffff00"><b>     @condition = "ripe"</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> f4 = Fruit.new</b></font>
<font color="#50ffff"><b>   "a ripe apple"</b></font></font></pre></td></tr></table>
<h3><a name="label:1" id="label:1">Changing assumptions to requirements</a></h3><!-- RDLabel: "Changing assumptions to requirements" -->
<p>There will be times when a default value doesn't make a lot of sense.
Is there such a thing as a default kind of fruit?  It may be
preferable to require that each piece of fruit have its kind specified
at the time of its creation.  To do this, we would add a formal
argument to the <code>initialize</code> method.  For reasons we won't
get into here, arguments you supply to <code>new</code> are actually
delivered to <code>initialize</code>.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class Fruit</b></font>
    |<font color="#ffff00"><b>   def initialize( k )</b></font>
    |<font color="#ffff00"><b>     @kind = k</b></font>
    |<font color="#ffff00"><b>     @condition = "ripe"</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> f5 = Fruit.new "mango"</b></font>
<font color="#50ffff"><b>   "a ripe mango"</b></font>
ruby&gt;<font color="#ffff00"><b> f6 = Fruit.new</b></font>
<font color="#50ffff"><b>ERR: (eval):1:in `initialize': wrong # of arguments(0 for 1)</b></font></font></pre></td></tr></table>
<h3><a name="label:2" id="label:2">Flexible initialization</a></h3><!-- RDLabel: "Flexible initialization" -->
<p>Above we see that once an argument is associated with the
<code>initialize</code> method, it can't be left off without
generating an error.  If we want to be more considerate, we can use
the argument if it is given, or fall back to default values otherwise.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="black"><tr><td><pre><font color="white">ruby&gt;<font color="#ffff00"><b> class Fruit</b></font>
    |<font color="#ffff00"><b>   def initialize( k="apple" )</b></font>
    |<font color="#ffff00"><b>     @kind = k</b></font>
    |<font color="#ffff00"><b>     @condition = "ripe"</b></font>
    |<font color="#ffff00"><b>   end</b></font>
    |<font color="#ffff00"><b> end</b></font>
<font color="#50ffff"><b>   nil</b></font>
ruby&gt;<font color="#ffff00"><b> f5 = Fruit.new "mango"</b></font>
<font color="#50ffff"><b>   "a ripe mango"</b></font>
ruby&gt;<font color="#ffff00"><b> f6 = Fruit.new</b></font>
<font color="#50ffff"><b>   "a ripe apple"</b></font></font></pre></td></tr></table>
<p>You can use default argument values for any method, not just
<code>initialize</code>.  The argument list must be arranged so that
those with default values come last.</p>
<p>Sometimes it is useful to provide several ways to initialize an
object.  Although it is outside the scope of this tutorial, ruby
supports object reflection and variable-length argument lists, which
together effectively allow method overloading.</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<a name="misc"></a><table bgcolor="#b00000" width="100%" cellpadding="15"  cellspacing="0" align="center" border="0"><tr><td width="10%">&nbsp;</td><td align="left" width="30%"><font face="georgia, charter" size="+2"  color="#b0d0d0">Ruby user's guide</font></td><td align="right" width="50%"><font face="georgia, charter" size="+2"  color="white">Nuts and bolts</font></td><td width="10%">&nbsp;</td></tr></table>

<p>This chapter addresses a few practical issues.</p>
<h3><a name="label:0" id="label:0">Statement delimiters</a></h3><!-- RDLabel: "Statement delimiters" -->
<p>Some languages require some kind of punctuation, often a semicolon
(<code>;</code>), to end each statement in a program.  Ruby
instead follows the convention used in shells like <code>sh</code> and
<code>csh</code>.  Multiple statements on one line must be
separated by semicolons, but they are not required at the end of a
line; a linefeed is treated like a semicolon.  If a line ends
with a backslash (<code>\</code>), the linefeed following it is
ignored; this allows you to have a single logical line that spans
several lines.</p>
<h3><a name="label:1" id="label:1">Comments</a></h3><!-- RDLabel: "Comments" -->
<p>Why write comments?  Although well written code tends to be
self-documenting, it is often helpful to scribble in the margins, and
it can be a mistake to believe that others will be able to look at
your code and immediately see it the way you do. Besides, for
practical purposes, you yourself are a different person within a few
days anyway; which of us hasn't gone back to fix or enhance a program
after the passage of time and said, I know I wrote this, but what in
blazes does it mean?</p>
<p>Some experienced programmers will point out, quite correctly, that
contradictory or outdated comments can be worse than none at all.
Certainly, comments shouldn't be a substitute for readable code; if
your code is unclear, it's probably also buggy.  You may find that you
need to comment more while you are learning ruby, and then less as you
become better at expressing your ideas in simple, elegant, readable
code.</p>
<p>Ruby follows a common scripting convention, which is to use a pound
symbol (<code>#</code>) to denote the start of a comment.  Anything
following an unquoted <code>#</code>, to the end of the line on which it
appears, is ignored by the interpreter.</p>
<p>Also, to facilitate large comment blocks, the ruby interpreter also
ignores anything between a line starting with "<code>=begin</code>" and
another line starting with "<code>=end</code>".</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">#!/usr/bin/env ruby

=begin
**********************************************************************
  This is a comment block, something you write for the benefit of
  human readers (including yourself).  The interpreter ignores it.
  There is no need for a '#' at the start of every line.
**********************************************************************
=end</font></pre></td></tr></table>
<h3><a name="label:2" id="label:2">Organizing your code</a></h3><!-- RDLabel: "Organizing your code" -->
<p>The ruby interpreter processes code as it reads it.  There is
nothing like a compilation phase; if something hasn't been read yet,
it is simply undefined.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black"># this results in an "undefined method" error:

print successor(3),"\n"

def successor(x)
  x + 1
end</font></pre></td></tr></table>
<p>This does not, as it might seem at first glance, force you to
organize your code in a strictly bottom-up fashion.  When the
interpreter encounters a method definition, it can safely include
undefined references, as long as you can be sure they will be defined
by the time the method is actually invoked:</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black"># Conversion of fahrenheit to celsius, broken
# down into two steps.

def f_to_c(f)
  scale(f - 32.0)  # This is a forward reference, but it's okay.
end

def scale(x)
  x * 5.0 / 9.0
end

printf "%.1f is a comfortable temperature.\n", f_to_c(72.3)</font></pre></td></tr></table>
<p>So while this may seem less convenient than what you may be used to
in Perl or Java, it is less restrictive than trying to write C without
prototypes (which would require you to always maintain a partial
ordering of what references what).  Putting top-level code at the
bottom of a source file always works.  And even this is less of an
annoyance than it might at first seem.  A sensible and painless way to
enforce the behavior you want is to define a <code>main</code> function at
the top of the file, and call it from the bottom.</p>
<p><table align="center" width="90%" border="1" cellpadding="6" bgcolor="#e8e8d8"><tr><td><pre><font color="black">#!/usr/bin/env ruby

def main
  # Express the top level logic here...
end

# ... put support code here, organized as you see fit ...

main # ... and start execution here.</font></pre></td></tr></table>
<p>It also helps that ruby provides tools for breaking complicated
programs into readable, reusable, logically related chunks.  We have
already seen the use of <code>include</code> for accessing modules.  You
will also find the <code>load</code> and <code>require</code> facilities useful.
<code>load</code> works as if the file it refers to were copied and pasted
in (something like the <code>#include</code> preprocessor directive in
C). <code>require</code> is somewhat more sophisticated, causing code
to be loaded at most once and only when needed.  There are other
differences between <code>load</code> and <code>require</code>; refer to the
language manual or the FAQ for more information.</p>
<h3><a name="label:3" id="label:3">That's it...</a></h3><!-- RDLabel: "That's it..." -->
<p>This tutorial should be enough to get you started writing programs in
Ruby.  As further questions arise, you can dig into the <a href="http://www.ruby-lang.org/en/man-1.4/">reference
manual</a> to
learn about ruby in more depth.  The
<a href="http://dev.rubycentral.com/faq/rubyfaq.html">FAQ</a> and
<a href="http://dev.rubycentral.com/ref/">library reference</a> are also
important resources.</p>
<p>Good luck, and happy coding!</p>

<a href="#index"><img border="0" src="a2u.gif" alt="top"></a><br>
<a href="#index">Back to top</a><br>
<hr><font size="-1">
<center>Single-page version of the Ruby User's Guide<br>
Sun Jun 16 01:55:51 JST 2002<br></center></font>
</body></html>
