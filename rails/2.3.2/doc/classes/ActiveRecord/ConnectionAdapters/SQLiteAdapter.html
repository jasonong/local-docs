  <div id="C00000717">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />SQLiteAdapter<br/>
  In:
<a href="#" onclick="jsHref('files/rails-2_3_2/activerecord/lib/active_record/connection_adapters/sqlite_adapter_rb.html');">rails-2.3.2/activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb</a>

Parent:&nbsp;
        <a href="#" onclick="jsHref('classes/ActiveRecord/ConnectionAdapters/AbstractAdapter.html');">
AbstractAdapter
         </a>
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
The SQLite adapter works with both the 2.x and 3.x series of SQLite with
the sqlite-ruby drivers (available both as gems and from <a
href="http://rubyforge.org/projects/sqlite-ruby"
target="_blank">http://rubyforge.org/projects/sqlite-ruby</a>/).
</p>
<p>
Options:
</p>
<ul>
<li><tt>:database</tt> - Path to the database file.

</li>
</ul>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M002075&name=catch_schema_changes" >catch_schema_changes</a></li>
  <li><a href="index.html?a=M002072&name=change_column_null" >change_column_null</a></li>
  <li><a href="index.html?a=M002077&name=default_primary_key_type" >default_primary_key_type</a></li>
  <li><a href="index.html?a=M002068&name=disconnect!" >disconnect!</a></li>
  <li><a href="index.html?a=M002073&name=empty_insert_statement" >empty_insert_statement</a></li>
  <li><a href="index.html?a=M002064&name=new" >new</a></li>
  <li><a href="index.html?a=M002070&name=rename_table" >rename_table</a></li>
  <li><a href="index.html?a=M002066&name=requires_reloading?" >requires_reloading?</a></li>
  <li><a href="index.html?a=M002069&name=select_rows" >select_rows</a></li>
  <li><a href="index.html?a=M002076&name=sqlite_version" >sqlite_version</a></li>
  <li><a href="index.html?a=M002067&name=supports_add_column?" >supports_add_column?</a></li>
  <li><a href="index.html?a=M002065&name=supports_ddl_transactions?" >supports_ddl_transactions?</a></li>
  <li><a href="index.html?a=M002074&name=table_structure" >table_structure</a></li>
  <li><a href="index.html?a=M002071&name=valid_alter_table_options" >valid_alter_table_options</a></li>
  </ul>



  <div class="sectiontitle">Classes and Modules</div>
  Class "<a href="#" onclick="jsHref('classes/ActiveRecord/ConnectionAdapters/SQLiteAdapter/Version.html');" class="link">ActiveRecord::ConnectionAdapters::SQLiteAdapter::Version</a>"<br />




<div class="sectiontitle">Public Class methods</div>
<div id="M002064" class="method">
  <div id="M002064_title" class="title">
    <b>new</b>(connection, logger, config)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002064_source')" id="l_M002064_source">show source</a> ]</p>
  <div id="M002064_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File rails-2.3.2/activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb, line 87</span>
87:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">logger</span>, <span class="ruby-identifier">config</span>)
88:         <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">logger</span>)
89:         <span class="ruby-ivar">@config</span> = <span class="ruby-identifier">config</span>
90:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div id="M002072" class="method">
  <div id="M002072_title" class="title">
    <b>change_column_null</b>(table_name, column_name, null, default = nil)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002072_source')" id="l_M002072_source">show source</a> ]</p>
  <div id="M002072_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File rails-2.3.2/activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb, line 272</span>
272:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">change_column_null</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">null</span>, <span class="ruby-identifier">default</span> = <span class="ruby-keyword kw">nil</span>)
273:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">null</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">default</span>.<span class="ruby-identifier">nil?</span>
274:           <span class="ruby-identifier">execute</span>(<span class="ruby-node">&quot;UPDATE #{quote_table_name(table_name)} SET #{quote_column_name(column_name)}=#{quote(default)} WHERE #{quote_column_name(column_name)} IS NULL&quot;</span>)
275:         <span class="ruby-keyword kw">end</span>
276:         <span class="ruby-identifier">alter_table</span>(<span class="ruby-identifier">table_name</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">definition</span><span class="ruby-operator">|</span>
277:           <span class="ruby-identifier">definition</span>[<span class="ruby-identifier">column_name</span>].<span class="ruby-identifier">null</span> = <span class="ruby-identifier">null</span>
278:         <span class="ruby-keyword kw">end</span>
279:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002068" class="method">
  <div id="M002068_title" class="title">
    <b>disconnect!</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002068_source')" id="l_M002068_source">show source</a> ]</p>
  <div id="M002068_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File rails-2.3.2/activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb, line 112</span>
112:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">disconnect!</span>
113:         <span class="ruby-keyword kw">super</span>
114:         <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
115:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002073" class="method">
  <div id="M002073_title" class="title">
    <b>empty_insert_statement</b>(table_name)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002073_source')" id="l_M002073_source">show source</a> ]</p>
  <div id="M002073_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File rails-2.3.2/activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb, line 300</span>
300:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">empty_insert_statement</span>(<span class="ruby-identifier">table_name</span>)
301:         <span class="ruby-node">&quot;INSERT INTO #{table_name} VALUES(NULL)&quot;</span>
302:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002070" class="method">
  <div id="M002070_title" class="title">
    <b>rename_table</b>(name, new_name)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002070_source')" id="l_M002070_source">show source</a> ]</p>
  <div id="M002070_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File rails-2.3.2/activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb, line 237</span>
237:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rename_table</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">new_name</span>)
238:         <span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;ALTER TABLE #{name} RENAME TO #{new_name}&quot;</span>
239:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002066" class="method">
  <div id="M002066_title" class="title">
    <b>requires_reloading?</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002066_source')" id="l_M002066_source">show source</a> ]</p>
  <div id="M002066_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File rails-2.3.2/activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb, line 104</span>
104:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">requires_reloading?</span>
105:         <span class="ruby-keyword kw">true</span>
106:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002069" class="method">
  <div id="M002069_title" class="title">
    <b>select_rows</b>(sql, name = nil)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002069_source')" id="l_M002069_source">show source</a> ]</p>
  <div id="M002069_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File rails-2.3.2/activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb, line 174</span>
174:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select_rows</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span> = <span class="ruby-keyword kw">nil</span>)
175:         <span class="ruby-identifier">execute</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
176:           (<span class="ruby-value">0</span><span class="ruby-operator">...</span>(<span class="ruby-identifier">row</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">/</span> <span class="ruby-value">2</span>)).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">row</span>[<span class="ruby-identifier">i</span>] }
177:         <span class="ruby-keyword kw">end</span>
178:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002067" class="method">
  <div id="M002067_title" class="title">
    <b>supports_add_column?</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002067_source')" id="l_M002067_source">show source</a> ]</p>
  <div id="M002067_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File rails-2.3.2/activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb, line 108</span>
108:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">supports_add_column?</span>
109:         <span class="ruby-identifier">sqlite_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value str">'3.1.6'</span>
110:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002065" class="method">
  <div id="M002065_title" class="title">
    <b>supports_ddl_transactions?</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002065_source')" id="l_M002065_source">show source</a> ]</p>
  <div id="M002065_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File rails-2.3.2/activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb, line 96</span>
96:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">supports_ddl_transactions?</span>
97:         <span class="ruby-identifier">sqlite_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value str">'2.0.0'</span>
98:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002071" class="method">
  <div id="M002071_title" class="title">
    <b>valid_alter_table_options</b>( type, options)
  </div>
  <div class="description">
  <p>
See: <a href="http://www.sqlite.org/lang_altertable.html"
target="_blank">http://www.sqlite.org/lang_altertable.html</a> SQLite has
an additional restriction on the ALTER TABLE statement
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002071_source')" id="l_M002071_source">show source</a> ]</p>
  <div id="M002071_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File rails-2.3.2/activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb, line 243</span>
243:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">valid_alter_table_options</span>( <span class="ruby-identifier">type</span>, <span class="ruby-identifier">options</span>)
244:         <span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_sym</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">:primary_key</span>
245:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Protected Instance methods</div>
<div id="M002075" class="method">
  <div id="M002075_title" class="title">
    <b>catch_schema_changes</b>() {|| ...}
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002075_source')" id="l_M002075_source">show source</a> ]</p>
  <div id="M002075_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File rails-2.3.2/activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb, line 402</span>
402:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">catch_schema_changes</span>
403:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">yield</span>
404:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exception</span>
405:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">exception</span>.<span class="ruby-identifier">message</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/database schema has changed/</span>
406:             <span class="ruby-identifier">reconnect!</span>
407:             <span class="ruby-keyword kw">retry</span>
408:           <span class="ruby-keyword kw">else</span>
409:             <span class="ruby-identifier">raise</span>
410:           <span class="ruby-keyword kw">end</span>
411:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002077" class="method">
  <div id="M002077_title" class="title">
    <b>default_primary_key_type</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002077_source')" id="l_M002077_source">show source</a> ]</p>
  <div id="M002077_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File rails-2.3.2/activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb, line 417</span>
417:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">default_primary_key_type</span>
418:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">supports_autoincrement?</span>
419:             <span class="ruby-value str">'INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL'</span>.<span class="ruby-identifier">freeze</span>
420:           <span class="ruby-keyword kw">else</span>
421:             <span class="ruby-value str">'INTEGER PRIMARY KEY NOT NULL'</span>.<span class="ruby-identifier">freeze</span>
422:           <span class="ruby-keyword kw">end</span>
423:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002076" class="method">
  <div id="M002076_title" class="title">
    <b>sqlite_version</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002076_source')" id="l_M002076_source">show source</a> ]</p>
  <div id="M002076_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File rails-2.3.2/activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb, line 413</span>
413:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sqlite_version</span>
414:           <span class="ruby-ivar">@sqlite_version</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">SQLiteAdapter</span><span class="ruby-operator">::</span><span class="ruby-constant">Version</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">select_value</span>(<span class="ruby-value str">'select sqlite_version(*)'</span>))
415:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002074" class="method">
  <div id="M002074_title" class="title">
    <b>table_structure</b>(table_name)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002074_source')" id="l_M002074_source">show source</a> ]</p>
  <div id="M002074_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File rails-2.3.2/activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb, line 317</span>
317:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">table_structure</span>(<span class="ruby-identifier">table_name</span>)
318:           <span class="ruby-identifier">returning</span> <span class="ruby-identifier">structure</span> = <span class="ruby-identifier">execute</span>(<span class="ruby-node">&quot;PRAGMA table_info(#{quote_table_name(table_name)})&quot;</span>) <span class="ruby-keyword kw">do</span>
319:             <span class="ruby-identifier">raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>, <span class="ruby-node">&quot;Could not find table '#{table_name}'&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">structure</span>.<span class="ruby-identifier">empty?</span>
320:           <span class="ruby-keyword kw">end</span>
321:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>